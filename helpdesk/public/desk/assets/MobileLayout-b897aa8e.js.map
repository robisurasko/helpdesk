{"version":3,"file":"MobileLayout-b897aa8e.js","sources":["../../../../desk/src/composables/mobile.ts","../../../../desk/src/components/layouts/MobileSidebar.vue","../../../../desk/src/components/layouts/MobileAppHeader.vue"],"sourcesContent":["import { ref } from \"vue\";\n\nexport const mobileSidebarOpened = ref(false);\n","<template>\n  <TransitionRoot :show=\"sidebarOpened\">\n    <Dialog as=\"div\" @close=\"sidebarOpened = false\" class=\"fixed inset-0 z-40\">\n      <TransitionChild\n        as=\"template\"\n        enter=\"transition ease-in-out duration-200 transform\"\n        enter-from=\"-translate-x-full\"\n        enter-to=\"translate-x-0\"\n        leave=\"transition ease-in-out duration-200 transform\"\n        leave-from=\"translate-x-0\"\n        leave-to=\"-translate-x-full\"\n      >\n        <div\n          class=\"relative z-10 flex h-full w-[230px] flex-col border-r bg-gray-50 transition-all duration-300 ease-in-out\"\n        >\n          <!-- user dropwdown -->\n          <div><UserMenu class=\"p-2 mb-2\" :options=\"profileSettings\" /></div>\n          <!-- notifications -->\n          <div class=\"overflow-y-auto px-2\" v-if=\"!isCustomerPortal\">\n            <div class=\"mb-3 flex flex-col\">\n              <SidebarLink\n                class=\"relative\"\n                label=\"Notifications\"\n                :icon=\"LucideBell\"\n                :on-click=\"() => (sidebarOpened = false)\"\n                :is-expanded=\"true\"\n                to=\"Notifications\"\n              >\n                <template #right>\n                  <Badge\n                    v-if=\"notificationStore.unread\"\n                    :label=\"notificationStore.unread\"\n                    theme=\"gray\"\n                    variant=\"subtle\"\n                  />\n                </template>\n              </SidebarLink>\n            </div>\n          </div>\n\n          <div v-for=\"view in allViews\" :key=\"view.label\">\n            <div\n              v-if=\"!view.hideLabel && view.views?.length\"\n              class=\"mx-2 my-2 h-1\"\n            />\n            <Section\n              :label=\"view.label\"\n              :hideLabel=\"view.hideLabel\"\n              :opened=\"view.opened\"\n            >\n              <template #header=\"{ opened, hide, toggle }\">\n                <div\n                  v-if=\"!hide\"\n                  class=\"flex cursor-pointer gap-1.5 px-1 text-base font-medium text-ink-gray-5 transition-all duration-300 ease-in-out\"\n                  :class=\"'ml-2 mt-4 h-7 w-auto opacity-100'\"\n                  @click=\"toggle()\"\n                >\n                  <FeatherIcon\n                    name=\"chevron-right\"\n                    class=\"h-4 text-ink-gray-9 transition-all duration-300 ease-in-out\"\n                    :class=\"{ 'rotate-90': opened }\"\n                  />\n                  <span>{{ view.label }}</span>\n                </div>\n              </template>\n              <nav class=\"flex flex-col ml-2 mr-1\">\n                <SidebarLink\n                  v-for=\"link in view.views\"\n                  :icon=\"link.icon\"\n                  :label=\"link.label\"\n                  :to=\"link.to\"\n                  :key=\"link.label\"\n                  :is-expanded=\"true\"\n                  :is-active=\"isActiveTab(link.to)\"\n                  class=\"my-0.5\"\n                  :onClick=\"link.onClick\"\n                />\n              </nav>\n            </Section>\n          </div>\n        </div>\n      </TransitionChild>\n      <TransitionChild\n        as=\"template\"\n        enter=\"transition-opacity ease-linear duration-200\"\n        enter-from=\"opacity-0\"\n        enter-to=\"opacity-100\"\n        leave=\"transition-opacity ease-linear duration-200\"\n        leave-from=\"opacity-100\"\n        leave-to=\"opacity-0\"\n      >\n        <DialogOverlay class=\"fixed inset-0 bg-gray-600 bg-opacity-50\" />\n      </TransitionChild>\n    </Dialog>\n  </TransitionRoot>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, markRaw } from \"vue\";\nimport {\n  TransitionRoot,\n  TransitionChild,\n  Dialog,\n  DialogOverlay,\n} from \"@headlessui/vue\";\nimport { useRouter, useRoute } from \"vue-router\";\n\nimport UserMenu from \"@/components/UserMenu.vue\";\nimport SidebarLink from \"@/components/SidebarLink.vue\";\nimport { Section } from \"@/components\";\nimport { useNotificationStore } from \"@/stores/notification\";\n\nimport { useView, currentView } from \"@/composables/useView\";\nimport { mobileSidebarOpened as sidebarOpened } from \"@/composables/mobile\";\n\nimport LucideBell from \"~icons/lucide/bell\";\n\nimport { CUSTOMER_PORTAL_LANDING } from \"@/router\";\nimport Apps from \"../Apps.vue\";\nimport {\n  agentPortalSidebarOptions,\n  customerPortalSidebarOptions,\n} from \"./layoutSettings\";\nimport { useAuthStore } from \"@/stores/auth\";\nconst { pinnedViews, publicViews } = useView();\nimport { isCustomerPortal } from \"@/utils\";\n\nconst notificationStore = useNotificationStore();\nconst route = useRoute();\nconst router = useRouter();\nconst authStore = useAuthStore();\n\nconst allViews = computed(() => {\n  const items = isCustomerPortal.value\n    ? customerPortalSidebarOptions\n    : agentPortalSidebarOptions;\n\n  const options = [\n    {\n      label: \"All Views\",\n      hideLabel: true,\n      opened: true,\n      views: items,\n    },\n  ];\n  if (publicViews.value?.length && !isCustomerPortal.value) {\n    options.push({\n      label: \"Public Views\",\n      opened: true,\n      hideLabel: false,\n      views: parseViews(publicViews.value),\n    });\n  }\n  if (pinnedViews.value?.length) {\n    options.push({\n      label: \"Private Views\",\n      opened: true,\n      hideLabel: false,\n      views: parseViews(pinnedViews.value),\n    });\n  }\n  return options;\n});\nfunction parseViews(views) {\n  return views.map((view) => {\n    return {\n      label: view.label,\n      icon: view.icon,\n      to: {\n        name: view.route_name,\n        query: { view: view.name },\n      },\n      onClick: () => {\n        currentView.value = {\n          label: view.label,\n          icon: view.icon,\n        };\n      },\n    };\n  });\n}\n\nconst customerPortalDropdown = computed(() => [\n  {\n    label: \"Log out\",\n    icon: \"log-out\",\n    onClick: () => authStore.logout(),\n  },\n]);\n\nconst agentPortalDropdown = computed(() => [\n  {\n    component: markRaw(Apps),\n  },\n    {\n    icon: \"user\",\n    label: \"My Profile\",\n    onClick: () => window.open(`${window.location.origin}/me`),\n  },\n  {\n    label: \"Customer portal\",\n    icon: \"users\",\n    onClick: () => {\n      const path = router.resolve({ name: CUSTOMER_PORTAL_LANDING });\n      window.open(path.href);\n    },\n  },\n  {\n    label: \"Log out\",\n    icon: \"log-out\",\n    onClick: () => authStore.logout(),\n  },\n]);\n\nconst profileSettings = computed(() => {\n  return isCustomerPortal.value\n    ? customerPortalDropdown.value\n    : agentPortalDropdown.value;\n});\n\nfunction isActiveTab(to: string) {\n  if (route.query.view) {\n    return route.query.view == to?.query?.view;\n  }\n  return route.name === to;\n}\n</script>\n\n<style scoped></style>\n","<template>\n  <div class=\"flex border-b h-12 items-center\">\n    <div class=\"z-20 -mr-4 ml-1 flex items-center justify-center\">\n      <Button variant=\"ghosted\" @click=\"sidebarOpened = !sidebarOpened\">\n        <FeatherIcon name=\"menu\" class=\"size-4\" />\n      </Button>\n    </div>\n    <header id=\"app-header\" class=\"w-full\"></header>\n    <!-- Status dropdown moved to its own line -->\n      <div class=\"flex flex-col items-center\">\n        <div class=\"flex items-center gap-2\">\n          <div class=\"flex items-center gap-1\">\n            <div class=\"w-2 h-2 rounded-full\" :class=\"{\n              'bg-green-500': agentStatus === 'Online',\n              'bg-yellow-500': agentStatus === 'Busy',\n              'bg-red-500': agentStatus === 'Offline'\n            }\"></div>\n            \n            <div class=\"relative\">\n              <select \n                v-model=\"agentStatus\" \n                class=\"appearance-none bg-gray-100 border border-gray-300 rounded text-xs px-1.5 py-0.5 pr-5 focus:outline-none focus:ring-1 focus:ring-blue-500 h-[1.25rem]\"\n                @change=\"updateAgentStatus\"\n              >\n                <option value=\"Online\">Online</option>\n                <option value=\"Busy\">Busy</option>\n                <option value=\"Offline\">Offline</option>\n              </select>\n              <div class=\"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-1 text-gray-500\">\n                <svg class=\"fill-current h-2.5 w-2.5\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n                  <path d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"/>\n                </svg>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n     </div> \n</template>\n\n<script setup>\nimport { mobileSidebarOpened as sidebarOpened } from \"@/composables/mobile\";\nimport { ref, onMounted } from 'vue';\nimport { createResource } from 'frappe-ui';\n\nconst agentStatus = ref('Offline');\nconst currentUser = ref('');\nconst agentDocName = ref('');\n\n// Load current user and their status\nonMounted(() => {\n  createResource({\n    url: 'frappe.auth.get_logged_user'\n  }).submit().then(user => {\n    currentUser.value = user;\n    \n    // Get the agent record for this user\n    createResource({\n      url: 'frappe.client.get_list',\n      params: {\n        doctype: 'HD Agent',\n        fields: ['name', 'custom_current_status'],\n        filters: { name: user },\n        limit: 1\n      }\n    }).submit().then(data => {\n      if (data && data.length > 0) {\n        agentDocName.value = data[0].name;\n        agentStatus.value = data[0].custom_current_status || 'Offline';\n      }\n    });\n  });\n});\n\n// Update agent status\nfunction updateAgentStatus() {\n  if (!agentDocName.value) return;\n  \n  createResource({\n    url: 'frappe.client.set_value',\n    params: {\n      doctype: 'HD Agent',\n      name: agentDocName.value,\n      fieldname: 'custom_current_status',\n      value: agentStatus.value\n    }\n  }).submit();\n}\n</script>\n\n<style scoped>\nselect {\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n  background-image: none;\n}\n</style>\n"],"names":["mobileSidebarOpened","ref","pinnedViews","publicViews","useView","notificationStore","useNotificationStore","route","useRoute","router","useRouter","authStore","useAuthStore","allViews","computed","options","isCustomerPortal","customerPortalSidebarOptions","agentPortalSidebarOptions","_a","parseViews","_b","views","view","currentView","customerPortalDropdown","agentPortalDropdown","markRaw","Apps","path","CUSTOMER_PORTAL_LANDING","profileSettings","isActiveTab","to","agentStatus","currentUser","agentDocName","onMounted","createResource","user","data","updateAgentStatus"],"mappings":"+mBAEa,MAAAA,EAAsBC,EAAI,EAAK,2TC0H5C,KAAM,CAAE,YAAAC,EAAa,YAAAC,CAAY,EAAIC,GAAQ,EAGvCC,EAAoBC,KACpBC,EAAQC,IACRC,EAASC,IACTC,EAAYC,IAEZC,EAAWC,EAAS,IAAM,SAK9B,MAAMC,EAAU,CACd,CACE,MAAO,YACP,UAAW,GACX,OAAQ,GACR,MATUC,EAAiB,MAC3BC,GACAC,EAQF,CAAA,EAEF,OAAIC,EAAAhB,EAAY,QAAZ,MAAAgB,EAAmB,QAAU,CAACH,EAAiB,OACjDD,EAAQ,KAAK,CACX,MAAO,eACP,OAAQ,GACR,UAAW,GACX,MAAOK,EAAWjB,EAAY,KAAK,CAAA,CACpC,GAECkB,EAAAnB,EAAY,QAAZ,MAAAmB,EAAmB,QACrBN,EAAQ,KAAK,CACX,MAAO,gBACP,OAAQ,GACR,UAAW,GACX,MAAOK,EAAWlB,EAAY,KAAK,CAAA,CACpC,EAEIa,CAAA,CACR,EACD,SAASK,EAAWE,EAAO,CAClB,OAAAA,EAAM,IAAKC,IACT,CACL,MAAOA,EAAK,MACZ,KAAMA,EAAK,KACX,GAAI,CACF,KAAMA,EAAK,WACX,MAAO,CAAE,KAAMA,EAAK,IAAK,CAC3B,EACA,QAAS,IAAM,CACbC,GAAY,MAAQ,CAClB,MAAOD,EAAK,MACZ,KAAMA,EAAK,IAAA,CAEf,CAAA,EAEH,CACH,CAEM,MAAAE,EAAyBX,EAAS,IAAM,CAC5C,CACE,MAAO,UACP,KAAM,UACN,QAAS,IAAMH,EAAU,OAAO,CAClC,CAAA,CACD,EAEKe,EAAsBZ,EAAS,IAAM,CACzC,CACE,UAAWa,EAAQC,EAAI,CACzB,EACE,CACA,KAAM,OACN,MAAO,aACP,QAAS,IAAM,OAAO,KAAK,GAAG,OAAO,SAAS,MAAM,KAAK,CAC3D,EACA,CACE,MAAO,kBACP,KAAM,QACN,QAAS,IAAM,CACb,MAAMC,EAAOpB,EAAO,QAAQ,CAAE,KAAMqB,EAAyB,EACtD,OAAA,KAAKD,EAAK,IAAI,CACvB,CACF,EACA,CACE,MAAO,UACP,KAAM,UACN,QAAS,IAAMlB,EAAU,OAAO,CAClC,CAAA,CACD,EAEKoB,EAAkBjB,EAAS,IACxBE,EAAiB,MACpBS,EAAuB,MACvBC,EAAoB,KACzB,EAED,SAASM,EAAYC,EAAY,OAC3B,OAAA1B,EAAM,MAAM,KACPA,EAAM,MAAM,QAAQY,EAAAc,GAAA,YAAAA,EAAI,QAAJ,YAAAd,EAAW,MAEjCZ,EAAM,OAAS0B,CACxB,y3ECpLA,MAAMC,EAAcjC,EAAI,SAAS,EAC3BkC,EAAclC,EAAI,EAAE,EACpBmC,EAAenC,EAAI,EAAE,EAG3BoC,EAAU,IAAM,CACdC,EAAe,CACb,IAAK,6BACN,CAAA,EAAE,OAAM,EAAG,KAAKC,GAAQ,CACvBJ,EAAY,MAAQI,EAGpBD,EAAe,CACb,IAAK,yBACL,OAAQ,CACN,QAAS,WACT,OAAQ,CAAC,OAAQ,uBAAuB,EACxC,QAAS,CAAE,KAAMC,CAAM,EACvB,MAAO,CACT,CACD,CAAA,EAAE,OAAM,EAAG,KAAKC,GAAQ,CACnBA,GAAQA,EAAK,OAAS,IACxBJ,EAAa,MAAQI,EAAK,CAAC,EAAE,KAC7BN,EAAY,MAAQM,EAAK,CAAC,EAAE,uBAAyB,UAE7D,CAAK,CACL,CAAG,CACH,CAAC,EAGD,SAASC,GAAoB,CACtBL,EAAa,OAElBE,EAAe,CACb,IAAK,0BACL,OAAQ,CACN,QAAS,WACT,KAAMF,EAAa,MACnB,UAAW,wBACX,MAAOF,EAAY,KACrB,CACJ,CAAG,EAAE,OAAM,CACX"}