{"version":3,"file":"EmailContent-4f13f404.js","sources":["../../../../desk/src/components/EmailContent.vue"],"sourcesContent":["<template>\n  <iframe\n    ref=\"iframeRef\"\n    :srcdoc=\"htmlContent\"\n    class=\"prose-f block h-10 max-h-[500px] w-full\"\n  />\n</template>\n\n<script setup>\nimport { ref, watch } from \"vue\";\nimport { getFontFamily } from \"@/utils\";\n\nconst props = defineProps({\n  content: {\n    type: String,\n    required: true,\n  },\n});\n\nconst files = import.meta.globEager(\"/src/index.css\", { query: \"?inline\" });\nconst css = files[\"/src/index.css\"].default;\n\nconst iframeRef = ref(null);\nconst _content = ref(props.content);\n\nconst parser = new DOMParser();\nconst doc = parser.parseFromString(_content.value, \"text/html\");\n\nconst gmailReplyToContent = doc.querySelectorAll(\"div.gmail_quote\");\nconst outlookReplyToContent = doc.querySelectorAll(\"div#appendonsend\");\nconst replyToContent = doc.querySelectorAll(\"p.reply-to-content\");\n\nif (gmailReplyToContent.length) {\n  _content.value = parseReplyToContent(doc, \"div.gmail_quote\", true);\n} else if (outlookReplyToContent.length) {\n  _content.value = parseReplyToContent(doc, \"div#appendonsend\");\n} else if (replyToContent.length) {\n  _content.value = parseReplyToContent(doc, \"p.reply-to-content\");\n}\n\nfunction parseReplyToContent(doc, selector, forGmail = false) {\n  function handleAllInstances(doc) {\n    const replyToContentElements = doc.querySelectorAll(selector);\n    if (replyToContentElements.length === 0) return;\n    const replyToContentElement = replyToContentElements[0];\n    replaceReplyToContent(replyToContentElement, forGmail);\n    handleAllInstances(doc);\n  }\n\n  handleAllInstances(doc);\n\n  return doc.body.innerHTML;\n}\n\nfunction replaceReplyToContent(replyToContentElement, forGmail) {\n  if (!replyToContentElement) return;\n  let randomId = Math.random().toString(36).substring(2, 7);\n  const wrapper = doc.createElement(\"div\");\n  wrapper.classList.add(\"replied-content\");\n\n  const collapseLabel = doc.createElement(\"label\");\n  collapseLabel.classList.add(\"collapse\");\n  collapseLabel.setAttribute(\"for\", randomId);\n  collapseLabel.innerHTML = \"...\";\n  wrapper.appendChild(collapseLabel);\n\n  const collapseInput = doc.createElement(\"input\");\n  collapseInput.setAttribute(\"id\", randomId);\n  collapseInput.setAttribute(\"class\", \"replyCollapser\");\n  collapseInput.setAttribute(\"type\", \"checkbox\");\n  wrapper.appendChild(collapseInput);\n\n  if (forGmail) {\n    const prevSibling = replyToContentElement.previousElementSibling;\n    if (prevSibling && prevSibling.tagName === \"BR\") {\n      prevSibling.remove();\n    }\n    let cloned = replyToContentElement.cloneNode(true);\n    cloned.classList.remove(\"gmail_quote\");\n    wrapper.appendChild(cloned);\n  } else {\n    const allSiblings = Array.from(\n      replyToContentElement.parentElement.children\n    );\n    const replyToContentIndex = allSiblings.indexOf(replyToContentElement);\n    const followingSiblings = allSiblings.slice(replyToContentIndex + 1);\n\n    if (followingSiblings.length === 0) return;\n\n    let clonedFollowingSiblings = followingSiblings.map((sibling) =>\n      sibling.cloneNode(true)\n    );\n\n    const div = doc.createElement(\"div\");\n    div.append(...clonedFollowingSiblings);\n\n    wrapper.append(div);\n\n    // Remove all siblings after the reply-to-content element\n    for (let i = replyToContentIndex + 1; i < allSiblings.length; i++) {\n      replyToContentElement.parentElement.removeChild(allSiblings[i]);\n    }\n  }\n\n  replyToContentElement.parentElement.replaceChild(\n    wrapper,\n    replyToContentElement\n  );\n}\n\nconst htmlContent = `\n  <!DOCTYPE html>\n  <html>\n  <head>\n\t<style>\n\t  ${css}\n  \n\t  .replied-content .collapse {\n\t\tmargin: 10px 0 10px 0;\n\t\tvisibility: visible;\n\t\tcursor: pointer;\n\t\tdisplay: flex;\n\t\tfont-size: larger;\n\t\tfont-weight: 700;\n\t\theight: 12px;\n\t\tline-height: 0.1;\n\t\tbackground: #e8eaed;\n\t\twidth: 23px;\n\t\tjustify-content: center;\n\t\tborder-radius: 5px;\n\t  }\n  \n\t  .replied-content .collapse:hover {\n\t\tbackground: #dadce0;\n\t  }\n  \n\t  .replied-content .collapse + input {\n\t\tdisplay: none;\n\t  }\n\t  .replied-content .collapse + input + div {\n\t\tdisplay: none;\n\t  }\n\t  .replied-content .collapse + input:checked + div {\n\t\tdisplay: block;\n\t  }\n  \n\t  .email-content {\n\t\t  word-break: break-word;\n\t  }\n\t  .email-content\n\t\t  :is(:where(table):not(:where([class~='not-prose'], [class~='not-prose']\n\t\t\t  *))) {\n\t  table-layout: auto;\n\t  }\n  \n\t  .email-content\n\t\t  :where(table):not(:where([class~='not-prose'], [class~='not-prose'] *)) {\n\t  width: unset;\n\t  table-layout: auto;\n\t  text-align: unset;\n\t  margin-top: unset;\n\t  margin-bottom: unset;\n\t  font-size: unset;\n\t  line-height: unset;\n\t  }\n  \n\t  /* tr */\n  \n\t  .email-content\n\t\t  :where(tbody tr):not(:where([class~='not-prose'], [class~='not-prose']\n\t\t\t  *)) {\n\t  border-bottom-width: 0;\n\t  border-bottom-color: transparent;\n\t  }\n  \n\t  /* td */\n  \n\t  .email-content\n\t\t  :is(:where(td):not(:where([class~='not-prose'], [class~='not-prose'] *))) {\n\t  position: unset;\n\t  border-width: 0;\n\t  border-color: transparent;\n\t  padding: 0;\n\t  }\n  \n\t  .email-content\n\t\t  :where(tbody td):not(:where([class~='not-prose'], [class~='not-prose']\n\t\t\t  *)) {\n\t  vertical-align: revert;\n\t  }\n  \n\t  /* image */\n\t  .email-content\n\t\t  :is(:where(img):not(:where([class~='not-prose'], [class~='not-prose']\n\t\t\t  *))) {\n\t  border-width: 0;\n\t  }\n  \n\t  .email-content\n\t\t  :where(img):not(:where([class~='not-prose'], [class~='not-prose'] *)) {\n\t  margin: 0;\n\t  }\n  \n\t  /* before & after */\n  \n\t  .email-content\n\t\t  :where(blockquote\n\t\t  p:first-of-type):not(:where([class~='not-prose'], [class~='not-prose']\n\t\t\t  *))::before {\n\t  content: none;\n\t  }\n  \n\t  .email-content\n\t\t  :where(blockquote\n\t\t  p:last-of-type):not(:where([class~='not-prose'], [class~='not-prose']\n\t\t\t  *))::after {\n\t  content: none;\n\t  }\n\t</style>\n  </head>\n  <body>\n\t  <div ref=\"emailContentRef\" class=\"email-content prose-f\">${_content.value}</div>\n  </body>\n  <base target=\"_blank\" />\n  </html>\n  `;\n\nwatch(iframeRef, (iframe) => {\n  if (iframe) {\n    iframe.onload = () => {\n      const emailContent =\n        iframe.contentWindow.document.querySelector(\".email-content\");\n      let parent = emailContent.closest(\"html\");\n      emailContent.classList.add(getFontFamily(_content.value));\n      iframe.style.height = parent.offsetHeight + 1 + \"px\";\n\n      let replyCollapsers = emailContent.querySelectorAll(\".replyCollapser\");\n      if (replyCollapsers.length) {\n        replyCollapsers.forEach((replyCollapser) => {\n          replyCollapser.addEventListener(\"change\", () => {\n            iframe.style.height = parent.offsetHeight + 1 + \"px\";\n          });\n        });\n      }\n    };\n  }\n});\n</script>\n"],"names":["props","__props","css","iframeRef","ref","_content","doc","gmailReplyToContent","outlookReplyToContent","replyToContent","parseReplyToContent","selector","forGmail","handleAllInstances","replyToContentElements","replyToContentElement","replaceReplyToContent","randomId","wrapper","collapseLabel","collapseInput","prevSibling","cloned","allSiblings","replyToContentIndex","followingSiblings","clonedFollowingSiblings","sibling","div","i","htmlContent","watch","iframe","emailContent","parent","getFontFamily","replyCollapsers","replyCollapser"],"mappings":"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"}