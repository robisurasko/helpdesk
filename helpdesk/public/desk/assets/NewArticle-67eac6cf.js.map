{"version":3,"file":"NewArticle-67eac6cf.js","sources":["../../../../desk/src/pages/knowledge-base/NewArticle.vue"],"sourcesContent":["<template>\n  <div class=\"flex flex-col flex-1\">\n    <LayoutHeader>\n      <template #left-header>\n        <Breadcrumbs :items=\"breadcrumbs\" />\n      </template>\n      <template #right-header> </template>\n    </LayoutHeader>\n    <div class=\"pt-6 mx-auto w-full max-w-4xl px-5\">\n      <div class=\"flex flex-col gap-3 rounded-lg border w-full p-4\">\n        <div class=\"flex justify-between items-center mb-3\">\n          <!-- Author Info -->\n          <div\n            class=\"flex gap-1 items-center flex-1 mr-7 max-w-fit overflow-hidden\"\n          >\n            <UserAvatar :name=\"user.name\" :expand=\"true\" />\n            <span>in</span>\n            <Link\n              class=\"form-control\"\n              doctype=\"HD Article Category\"\n              placeholder=\"Select Category\"\n              v-model=\"categoryId\"\n              :pageLength=\"100\"\n              :hide-clear-button=\"true\"\n            />\n          </div>\n          <!-- Action Buttons -->\n          <div class=\"flex gap-2\">\n            <Button label=\"Discard\" @click=\"handleArticleDiscard\" />\n            <Button\n              label=\"Create\"\n              variant=\"solid\"\n              @click=\"handleCreateArticle\"\n            />\n          </div>\n        </div>\n        <!-- Title -->\n        <textarea\n          class=\"w-full resize-none border-0 text-3xl font-bold placeholder-ink-gray-3 p-0 pb-3 border-b border-gray-200 focus:ring-0 focus:border-gray-200\"\n          v-model=\"title\"\n          placeholder=\"Title\"\n          rows=\"1\"\n          wrap=\"soft\"\n          maxlength=\"140\"\n          autofocus\n          @input=\"\n          (e: Event) => {\n            const target = e.target as HTMLTextAreaElement;\n            target.style.height = `${target.scrollHeight}px`;\n          }\n          \"\n        />\n        <!-- Article Content -->\n        <TextEditor\n          :content=\"content\"\n          @change=\"content = $event\"\n          placeholder=\"Write your article here...\"\n          editor-class=\"rounded-b-lg max-w-[unset] prose-sm h-[calc(100vh-340px)] sm:h-[calc(100vh-250px)] overflow-auto\"\n        >\n          <template #bottom>\n            <TextEditorFixedMenu\n              class=\"-ml-1 overflow-x-auto w-full\"\n              :buttons=\"textEditorMenuButtons\"\n            />\n          </template>\n        </TextEditor>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from \"vue\";\nimport {\n  usePageMeta,\n  TextEditor,\n  TextEditorFixedMenu,\n  Breadcrumbs,\n} from \"frappe-ui\";\nimport { useRouter, useRoute } from \"vue-router\";\nimport { newArticle } from \"@/stores/knowledgeBase\";\nimport { useUserStore } from \"@/stores/user\";\nimport { globalStore } from \"@/stores/globalStore\";\nimport { LayoutHeader, UserAvatar } from \"@/components\";\nimport { createToast, textEditorMenuButtons } from \"@/utils\";\nimport { Article } from \"@/types\";\n\nconst userStore = useUserStore();\nconst user = userStore.getUser();\nconst { $dialog } = globalStore();\nconst router = useRouter();\nconst route = useRoute();\n\nconst title = ref(\"\");\nconst content = ref(\"\");\n\nconst props = defineProps({\n  id: {\n    type: String,\n    required: true,\n  },\n});\n\nconst categoryId = ref(props.id || null);\nconst categoryName = computed(() => (route.query.title as string) || \"\");\n\nfunction handleCreateArticle() {\n  newArticle.submit(\n    { title: title.value, content: content.value, category: categoryId.value },\n    {\n      onSuccess: (article: Article) => {\n        createToast({\n          title: \"Article created successfully\",\n          icon: \"check\",\n          iconClasses: \"text-green-600\",\n        });\n        resetState();\n        router.push({\n          name: \"Article\",\n          params: {\n            articleId: article.name,\n          },\n        });\n      },\n      onError: (error: string) => {\n        createToast({\n          title: error,\n          icon: \"x\",\n          iconClasses: \"text-red-600\",\n        });\n      },\n    }\n  );\n}\nfunction handleArticleDiscard() {\n  if (!title.value && !content.value) {\n    router.push({\n      name: \"AgentKnowledgeBase\",\n    });\n    return;\n  }\n  $dialog({\n    title: \"Discard Article\",\n    message: \"Are you sure you want to discard this article?\",\n    actions: [\n      {\n        label: \"Confirm\",\n        variant: \"solid\",\n        onClick(close: Function) {\n          router.push({\n            name: \"AgentKnowledgeBase\",\n          });\n          resetState();\n          close();\n        },\n      },\n    ],\n  });\n}\n\nfunction resetState() {\n  title.value = \"\";\n  content.value = \"\";\n}\n\nconst breadcrumbs = computed(() => {\n  const options: Array<{ label: string; route?: { name: string } }> = [\n    {\n      label: \"Knowledge Base\",\n      route: { name: \"AgentKnowledgeBase\" },\n    },\n  ];\n  if (categoryName.value) {\n    options.push({\n      label: categoryName.value,\n      route: { name: \"AgentKnowledgeBase\" },\n    });\n  }\n  options.push({\n    label: \"New Article\",\n  });\n  return options;\n});\n\nusePageMeta(() => {\n  return {\n    title: \"New Article\",\n  };\n});\n</script>\n"],"names":["user","useUserStore","$dialog","globalStore","router","useRouter","route","useRoute","title","ref","content","categoryId","__props","categoryName","computed","handleCreateArticle","newArticle","article","createToast","resetState","error","handleArticleDiscard","close","breadcrumbs","options","usePageMeta"],"mappings":"6lCAwFM,MAAAA,EADYC,IACK,UACjB,CAAE,QAAAC,GAAYC,IACdC,EAASC,IACTC,EAAQC,IAERC,EAAQC,EAAI,EAAE,EACdC,EAAUD,EAAI,EAAE,EAShBE,EAAaF,EAPLG,EAOe,IAAM,IAAI,EACjCC,EAAeC,EAAS,IAAOR,EAAM,MAAM,OAAoB,EAAE,EAEvE,SAASS,GAAsB,CAClBC,EAAA,OACT,CAAE,MAAOR,EAAM,MAAO,QAASE,EAAQ,MAAO,SAAUC,EAAW,KAAM,EACzE,CACE,UAAYM,GAAqB,CACnBC,EAAA,CACV,MAAO,+BACP,KAAM,QACN,YAAa,gBAAA,CACd,EACUC,IACXf,EAAO,KAAK,CACV,KAAM,UACN,OAAQ,CACN,UAAWa,EAAQ,IACrB,CAAA,CACD,CACH,EACA,QAAUG,GAAkB,CACdF,EAAA,CACV,MAAOE,EACP,KAAM,IACN,YAAa,cAAA,CACd,CACH,CACF,CAAA,CAEJ,CACA,SAASC,GAAuB,CAC9B,GAAI,CAACb,EAAM,OAAS,CAACE,EAAQ,MAAO,CAClCN,EAAO,KAAK,CACV,KAAM,oBAAA,CACP,EACD,MACF,CACQF,EAAA,CACN,MAAO,kBACP,QAAS,iDACT,QAAS,CACP,CACE,MAAO,UACP,QAAS,QACT,QAAQoB,EAAiB,CACvBlB,EAAO,KAAK,CACV,KAAM,oBAAA,CACP,EACUe,IACLG,GACR,CACF,CACF,CAAA,CACD,CACH,CAEA,SAASH,GAAa,CACpBX,EAAM,MAAQ,GACdE,EAAQ,MAAQ,EAClB,CAEM,MAAAa,EAAcT,EAAS,IAAM,CACjC,MAAMU,EAA8D,CAClE,CACE,MAAO,iBACP,MAAO,CAAE,KAAM,oBAAqB,CACtC,CAAA,EAEF,OAAIX,EAAa,OACfW,EAAQ,KAAK,CACX,MAAOX,EAAa,MACpB,MAAO,CAAE,KAAM,oBAAqB,CAAA,CACrC,EAEHW,EAAQ,KAAK,CACX,MAAO,aAAA,CACR,EACMA,CAAA,CACR,EAED,OAAAC,EAAY,KACH,CACL,MAAO,aAAA,EAEV"}