import{E as G,_ as Q}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-d43e6b85.js";import{_ as W,T as X,A as tt,C as et,a as at,b as st,c as ot,d as nt,e as it,f as lt,g as rt}from"./TicketAgentFields-d9f1f03a.js";import{s as ct,_ as dt}from"./formCustomisation-a51d73dc.js";import{j as ut,o as l,k as v,am as mt,d as pt,an as ft,B as p,c as vt,Z as M,e as U,K as kt,V as N,O as _t,a6 as bt,r as R,h as e,f,w as r,g as i,l as u,x as yt,y,v as gt,s as F,b as xt,a8 as ht,Y as wt,J as At,U as Ct}from"./index-adf298f8.js";import{_ as $t}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-80786aad.js";import{_ as Vt}from"./Dropdown.vue_vue_type_script_setup_true_lang-897a4f2b.js";import"./useView-5b009477.js";import"./more-horizontal-20f1eb21.js";import"./dayjs-60adf9f1.js";import{_ as It}from"./LayoutHeader-bce3c99e.js";import{_ as Tt}from"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-8d16be7a.js";import{u as St,I as z}from"./ticketStatus-9811864f.js";import"./knowledgeBase-b1232fe2.js";import"./merge-7ca924d6.js";import{g as Ut}from"./globalStore-8ebc48d0.js";import"./StarRating.vue_vue_type_script_setup_true_lang-b2c7cb07.js";import"./FileUploader-310a50a0.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-b12fb957.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-f6992848.js";import"./Avatar.vue_vue_type_script_setup_true_lang-53016530.js";import"./agent-d2b033e5.js";import"./Autocomplete-66b6f0bf.js";import"./EmailContent-32c1fdbf.js";import"./Link-05c6151f.js";const jt={},Bt={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-list-collapse"};function Et(I,k){return l(),v("svg",Bt,k[0]||(k[0]=[mt('<path d="m3 10 2.5-2.5L3 5"></path><path d="m3 19 2.5-2.5L3 14"></path><path d="M10 6h11"></path><path d="M10 12h11"></path><path d="M10 18h11"></path>',5)]))}const Dt=ut(jt,[["render",Et]]),Mt={class:"flex flex-col"},Nt={class:"absolute right-0 pr-2"},Rt={key:1,class:"flex h-12 items-center justify-between py-[7px] px-3 border-b"},Ft={class:"flex items-center gap-2 max-w-[50%]"},zt={key:0},Lt={class:"flex items-center gap-2"},Ht={key:2,class:"flex flex-1 overflow-x-hidden"},Ot={class:"flex flex-1 flex-col overflow-x-hidden"},Pt={class:"flex-1 flex flex-col"},Jt={key:0},ke=pt({__name:"MobileTicketAgent",props:{ticketId:{type:String,required:!0}},setup(I){const k=St(),{getUser:j}=ft(),L=xt(),B=p(null),g=p(null),x=p(null),T=p(!1),A=I;ht("communicationArea",g);const{isMobileView:H}=vt(),{$dialog:O}=Ut(),C=p(!1),$=p(!1),s=M({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_one",cache:["Ticket",A.ticketId],auto:!0,params:{name:A.ticketId},transform:o=>{o._assign&&(o.assignees=JSON.parse(o._assign).map(t=>({name:t,image:j(t).user_image,label:j(t).full_name})))},onSuccess:o=>{x.value=o.subject,ct(o,{doc:o,call:Ct,router:L,$dialog:O,updateField:P,createToast:N})}});function P(o,t,h=()=>{}){V(o,t),h()}const J=U(()=>{var t;let o=[{label:"Tickets",route:{name:"TicketsAgent"}}];return o.push({label:(t=s.data)==null?void 0:t.subject,route:{name:"TicketAgent"}}),o}),q=U(()=>k.options.map(o=>({label:o,value:o,onClick:()=>V("status",o),icon:()=>kt(z,{class:k.textColorMap[o]})}))),S=p(0),K=[{name:"details",label:"Details",icon:Dt,condition:()=>H.value},{name:"activity",label:"Activity",icon:tt},{name:"email",label:"Emails",icon:G},{name:"comment",label:"Comments",icon:et}],E=U(()=>{const o=s.data.communications.map((a,c)=>({type:"email",key:a.creation,sender:{name:a.user.email,full_name:a.user.name},to:a.recipients,cc:a.cc,bcc:a.bcc,creation:a.creation,subject:a.subject,attachments:a.attachments,content:a.content,isFirstEmail:c===0})),t=s.data.comments.map(a=>({name:a.name,type:"comment",key:a.creation,commentedBy:a.commented_by,commenter:a.user.name,creation:a.creation,content:a.content})),h=[...s.data.history,...s.data.views].map(a=>({type:"history",key:a.creation,content:a.action?a.action:"viewed this",creation:a.creation,user:a.user.name+" "})),d=[...o,...t,...h].sort((a,c)=>new Date(a.creation)-new Date(c.creation)),w=[];let m=0;for(;m<d.length;){const a=d[m];if(a.type==="history"){a.relatedActivities=[];for(let c=m+1;c<d.length+1;c++){const _=d[c];if(_&&_.type==="history")a.relatedActivities.push(_);else{w.push(a),m=c-1;break}}}else w.push(a);m++}return w});function Y(o){return o==="activity"?E.value:E.value.filter(t=>t.type===o)}function V(o,t){T.value=!0,M({url:"frappe.client.set_value",params:{doctype:"HD Ticket",name:A.ticketId,fieldname:o,value:t},auto:!0,onSuccess:()=>{T.value=!1,s.reload(),N({title:"Ticket updated",icon:"check",iconClasses:"text-green-600"})}})}return _t(()=>{document.title=A.ticketId}),bt(()=>{document.title="Helpdesk"}),(o,t)=>{var c,_;const h=R("FeatherIcon"),d=R("Button"),w=dt,m=at,a=Q;return l(),v("div",Mt,[e(s).data?(l(),f(e(It),{key:0},{"left-header":r(()=>[i(e($t),{items:J.value},null,8,["items"])]),"right-header":r(()=>[u("div",Nt,[i(e(Vt),{options:q.value},{default:r(({open:n})=>[i(d,{label:e(s).data.status},{prefix:r(()=>[i(e(z),{class:yt(e(k).textColorMap[e(s).data.status])},null,8,["class"])]),suffix:r(()=>[i(h,{name:n?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])])]),_:1})):y("",!0),e(s).data?(l(),v("header",Rt,[u("div",Ft,[(c=e(s).data.assignees)!=null&&c.length?(l(),v("div",zt,[(l(),f(gt(e(s).data.assignees.length==1?"Button":"div"),null,{default:r(()=>[i(e(Tt),{avatars:e(s).data.assignees,onClick:t[0]||(t[0]=n=>C.value=!0)},null,8,["avatars"])]),_:1}))])):(l(),v("button",{key:1,class:"rounded bg-gray-100 px-2 py-1.5 text-base text-gray-800",onClick:t[1]||(t[1]=n=>C.value=!0)}," Assign "))]),u("div",Lt,[e(s).data._customActions?(l(),f(w,{key:0,actions:e(s).data._customActions},null,8,["actions"])):y("",!0)])])):y("",!0),e(s).data?(l(),v("div",Ht,[u("div",Ot,[u("div",Pt,[i(e(it),{modelValue:S.value,"onUpdate:modelValue":t[7]||(t[7]=n=>S.value=n),tabs:K},{default:r(()=>[i(e(st)),i(e(ot),{class:"h-full"},{default:r(({tab:n})=>{var D;return[n.name==="details"?(l(),v("div",Jt,[i(m,{contact:e(s).data.contact,"onEmail:open":t[2]||(t[2]=b=>g.value.toggleEmailBox())},null,8,["contact"]),e(s).data.feedback_rating?(l(),f(a,{key:0,class:"border-b px-6 py-3 text-base text-gray-600",ticket:e(s).data},null,8,["ticket"])):y("",!0),t[16]||(t[16]=u("h3",{class:"px-6 pt-3 font-semibold text-base"},"SLA",-1)),i(W,{ticket:e(s).data},null,8,["ticket"]),t[17]||(t[17]=u("h3",{class:"px-6 pt-3 font-semibold text-base"},"Details",-1)),i(X,{ticket:e(s).data,onUpdate:t[3]||(t[3]=({field:b,value:Z})=>V(b,Z)),class:"!border-0"},null,8,["ticket"])])):(l(),f(e(nt),{key:1,ref_key:"ticketAgentActivitiesRef",ref:B,activities:Y(n.name),title:n.label,"ticket-status":(D=e(s).data)==null?void 0:D.status,onUpdate:t[4]||(t[4]=()=>{e(s).reload()}),"onEmail:reply":t[5]||(t[5]=b=>{g.value.replyToEmail(b)}),"onEmail:forward":t[6]||(t[6]=b=>{g.value.forwardEmail(b)})},null,8,["activities","title","ticket-status"]))]}),_:1})]),_:1},8,["modelValue"]),(l(),f(e(lt),{class:"sticky bottom-0 z-50 bg-white",ref_key:"communicationAreaRef",ref:g,modelValue:e(s).data,"onUpdate:modelValue":t[8]||(t[8]=n=>e(s).data=n),"to-emails":[e(s).data.raised_by],"cc-emails":[],"bcc-emails":[],key:(_=e(s).data)==null?void 0:_.name,onUpdate:t[9]||(t[9]=()=>{e(s).reload(),S.value!==0&&B.value.scrollToLatestActivity()})},null,8,["modelValue","to-emails"]))])])])):y("",!0),e(s).data?(l(),f(e(rt),{key:3,modelValue:C.value,"onUpdate:modelValue":t[10]||(t[10]=n=>C.value=n),assignees:e(s).data.assignees,docname:I.ticketId,doctype:"HD Ticket",onUpdate:t[11]||(t[11]=()=>{e(s).reload()})},null,8,["modelValue","assignees","docname"])):y("",!0),i(e(At),{modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=n=>$.value=n)},{"body-title":r(()=>t[18]||(t[18]=[u("h3",null,"Rename",-1)])),"body-content":r(()=>[i(e(wt),{modelValue:x.value,"onUpdate:modelValue":t[12]||(t[12]=n=>x.value=n),type:"text",size:"sm",variant:"subtle",disabled:!1,label:"New Subject"},null,8,["modelValue"])]),actions:r(()=>[i(d,{variant:"solid",disabled:!x.value,loading:T.value,onClick:t[13]||(t[13]=()=>{V("subject",x.value),$.value=!1})},{default:r(()=>t[19]||(t[19]=[F(" Confirm ")])),_:1},8,["disabled","loading"]),i(d,{class:"ml-2",onClick:t[14]||(t[14]=n=>$.value=!1)},{default:r(()=>t[20]||(t[20]=[F(" Close ")])),_:1})]),_:1},8,["modelValue"])])}}});export{ke as default};
//# sourceMappingURL=MobileTicketAgent-42e8983f.js.map
