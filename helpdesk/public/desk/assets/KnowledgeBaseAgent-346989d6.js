import{_ as O}from"./plus-36546025.js";import{d as M,m as A,n as V,e as D,B as m,ab as J,o as S,f as U,w as b,l as _,a0 as Q,af as W,h as x,J as H,r as Z,s as T,t as j,g,p as z,Z as F,K as $,W as X,L as Y,O as ee,S as B,Q as te,k as le,b as ae,ad as oe,V as d,a2 as se}from"./index-14da1b96.js";import{_ as ie}from"./Dropdown.vue_vue_type_script_setup_true_lang-608b497a.js";import{m as re,n as ne,b as ue,d as ce,e as de,f as ge}from"./knowledgeBase-b86a51f6.js";import{g as me}from"./globalStore-bd2d7230.js";import{_ as pe}from"./LayoutHeader-3516895f.js";import{_ as fe}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-56579779.js";import{_ as ye}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-c719d486.js";import{L as ve}from"./merge-cfbfa133.js";import"./useView-c256aa2e.js";import"./more-horizontal-4b0bead1.js";import"./dayjs-1848fb71.js";import{_ as be}from"./Link-e283dcda.js";import"./label-1cba8d02.js";import"./StarRating.vue_vue_type_script_setup_true_lang-a90aa5a3.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-5e1b94f1.js";import"./Avatar.vue_vue_type_script_setup_true_lang-31924be6.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-694290f0.js";const Ce={class:"flex flex-col flex-1 gap-3"},he=M({__name:"CategoryModal",props:A({title:{type:String,default:""},edit:{type:Boolean,default:!1}},{modelValue:{type:Boolean},modelModifiers:{},title:{},titleModifiers:{}}),emits:A(["update","create"],["update:modelValue","update:title"]),setup(C,{emit:f}){const y=C,l=f,c=V(C,"modelValue"),s=V(C,"title"),a=D(()=>y.edit?"Edit Category":"Create Category"),n=m(null);J(()=>n.value,i=>{i&&(n.value.style.height=(i.scrollHeight>i.clientHeight,i.scrollHeight+"px"))});function u(){const i=[];return y.edit?i.push({label:"Save",variant:"solid",onClick:()=>{l("update")}}):i.push({label:"Create",variant:"solid",onClick:()=>{l("create")}}),i}return(i,p)=>(S(),U(x(H),{modelValue:c.value,"onUpdate:modelValue":p[2]||(p[2]=v=>c.value=v),options:{title:a.value,actions:u()}},{"body-content":b(()=>[_("div",Ce,[Q(_("textarea",{class:"text-base rounded py-1.5 px-2 border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full block",ref_key:"titleRef",ref:n,placeholder:"Support Issues","onUpdate:modelValue":p[0]||(p[0]=v=>s.value=v),rows:1,maxlength:"50",autofocus:"",onInput:p[1]||(p[1]=v=>{const k=v.target;k.style.height=`${k.scrollHeight}px`})},null,544),[[W,s.value]])])]),_:1},8,["modelValue","options"]))}}),_e={class:"text-p-base text-ink-gray-8 mb-4"},xe={class:"whitespace-nowrap font-semibold"},ke=M({__name:"MergeCategoryModal",props:A({categoryId:{},categoryTitle:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:A(["merge"],["update:modelValue"]),setup(C,{emit:f}){const y=f,l=V(C,"modelValue"),c=m("");return(s,a)=>{const n=Z("Button");return S(),U(x(H),{options:{title:"Merge with another category"},onAfterLeave:a[2]||(a[2]=()=>{c.value=null}),modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value=u)},{"body-content":b(()=>[_("p",_e,[a[4]||(a[4]=T(" This will move all articles of the ")),_("span",xe,j(s.categoryTitle),1),a[5]||(a[5]=T(" category to the selected category. This change is irreversible! "))]),g(x(be),{class:"form-control",doctype:"HD Article Category",placeholder:"Select Category",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=u=>c.value=u),label:"Category","page-length":100},null,8,["modelValue"])]),actions:b(()=>[g(n,{class:"w-full",variant:"solid",label:"Merge",onClick:a[1]||(a[1]=u=>y("merge",s.categoryId,c.value))})]),_:1},8,["modelValue"])}}}),we={class:"flex flex-col"},Ge=M({__name:"KnowledgeBaseAgent",setup(C){const f=ae(),{$dialog:y}=me(),l=z({title:"",id:""}),c=m(""),s=m(null),a=m(!1),n=m(!1),u=m(!1),i=m(!1),p=F({url:"helpdesk.api.knowledge_base.get_general_category",auto:!0,cache:["GeneralCategory"]}),v=[{label:"Category",icon:"folder",onClick:()=>{w(),a.value=!1,n.value=!0}},{label:"Article",icon:"file-text",onClick:()=>{f.push({name:"NewArticle",params:{id:p.data},query:{title:"General"}})}}],k=[{label:"Add New Article",icon:"plus",onClick:e=>{f.push({name:"NewArticle",params:{id:e.group.value},query:{title:e.group.label}})}},{label:"Edit Title",icon:"edit",onClick:e=>{a.value=!0,n.value=!0,l.title=e.group.label,l.id=e.group.value,c.value=e.group.label}},{label:"Merge",icon:ve,onClick:e=>{i.value=!0,l.title=e.group.label,l.id=e.group.value}},{label:"Share",icon:"link",onClick:async({group:e})=>{const{label:t,value:o}=e,r=new URL(window.location.href);r.pathname=`/helpdesk/kb-public/${o}`,await oe(r.href,t)}},{label:"Delete",icon:"trash-2",onClick:e=>{R(e)}}],h=m(new Set),E=[{label:"Move To",icon:"corner-up-right",onClick:e=>{h.value=new Set(e),u.value=!0}},{label:"Delete",icon:"trash-2",onClick:e=>{h.value=e,y({title:"Delete articles?",message:"Are you sure you want to delete these articles?",actions:[{label:"Confirm",variant:"solid",onClick(t){K(),t()}}]})}}];function I(e){re.submit({category:e,articles:Array.from(h.value)},{onSuccess:()=>{var t,o;u.value=!1,(t=s.value)==null||t.reload(),(o=s.value)==null||o.unselectAll(),h.value.clear(),d({title:"Articles moved successfully",icon:"check",iconClasses:"text-green-600"})},onError:t=>{var o;d({title:((o=t==null?void 0:t.messages)==null?void 0:o[0])||t.message,icon:"x",iconClasses:"text-red-600"}),u.value=!1}})}function L(){ne.submit({title:l.title},{onSuccess:e=>{s.value.reload(),n.value=!1,f.push({name:"Article",params:{articleId:e.article},query:{category:e.category,title:l.title,isEdit:1}}),d({title:"Category Created Successfully",icon:"check",iconClasses:"text-green-600"}),B("category_created",{data:{category:l.title}}),w()},onError:e=>{d({title:e,icon:"x",iconClasses:"text-red-600"})}})}function N(){if(l.title===c.value){n.value=!1,a.value=!1;return}ue.submit({doctype:"HD Article Category",name:l.id,fieldname:"category_name",value:l.title},{onSuccess:()=>{s.value.reload(),n.value=!1,a.value=!1,d({title:"Category Updated Successfully",icon:"check",iconClasses:"text-green-600"}),w()},onError:e=>{d({title:e,icon:"x",iconClasses:"text-red-600"})}})}function R(e){y({title:"Delete category?",message:"All articles from this category will move to General category.",actions:[{label:"Confirm",variant:"solid",onClick(t){ce.submit({doctype:"HD Article Category",name:e.group.value},{onSuccess:()=>{d({title:"Category deleted successfully",icon:"check",iconClasses:"text-green-600"}),s.value.reload()}}),t()}}]})}function K(){de.submit({articles:Array.from(h.value)},{onSuccess:()=>{var e,t,o;(e=s.value)==null||e.reload(),(t=s.value)==null||t.unselectAll(),(o=h.value)==null||o.clear(),d({title:"Articles deleted successfully",icon:"check",iconClasses:"text-green-600"})}})}function P(e,t){ge.submit({source:e,target:t},{onSuccess:()=>{s.value.reload(),d({title:"Category merged successfully",icon:"check",iconClasses:"text-green-600"}),i.value=!1,w()},onError:o=>{var r;d({title:((r=o==null?void 0:o.messages)==null?void 0:r[0])||o.message,icon:"x",iconClasses:"text-red-600"})}})}function w(){l.title="",l.id="",c.value=""}const q=D(()=>({doctype:"HD Article",selectable:!0,view:{view_type:"group_by",group_by_field:"category",label_doc:"HD Article Category",label_field:"category_name"},columnConfig:{title:{prefix:()=>$(X,{name:"file-text",class:"h-4 w-4 flex-shrink-0 text-ink-gray-6"})},status:{custom:({item:e})=>$(Y,{...G[e]})}},rowRoute:{name:"Article",prop:"articleId"},groupByActions:k,showSelectBanner:!0,selectBannerActions:E,default_page_length:100})),G={Published:{label:"Published",theme:"green"},Draft:{label:"Draft",theme:"orange"},Archived:{label:"Archived",theme:"gray"}};return ee(()=>{B("kb_agent_page_viewed")}),te(()=>({title:"Knowledge Base"})),(e,t)=>{const o=O;return S(),le("div",we,[g(pe,null,{"left-header":b(()=>t[5]||(t[5]=[_("div",{class:"text-lg font-medium text-gray-900"},"Knowledge Base",-1)])),"right-header":b(()=>[g(x(ie),{options:v},{default:b(()=>[g(x(se),{label:"Add new",variant:"solid"},{prefix:b(()=>[g(o,{class:"h-4 w-4"})]),_:1})]),_:1})]),_:1}),g(fe,{ref_key:"listViewRef",ref:s,options:q.value,onRowClick:t[0]||(t[0]=r=>e.$router.push(`kb/articles/${r}`))},null,8,["options"]),g(he,{edit:a.value,modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=r=>n.value=r),title:l.title,"onUpdate:title":t[2]||(t[2]=r=>l.title=r),onUpdate:N,onCreate:L},null,8,["edit","modelValue","title"]),g(ye,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=r=>u.value=r),onMove:I},null,8,["modelValue"]),g(ke,{categoryTitle:l.title,"category-id":l.id,modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=r=>i.value=r),onMerge:P},null,8,["categoryTitle","category-id","modelValue"])])}}});export{Ge as default};
//# sourceMappingURL=KnowledgeBaseAgent-346989d6.js.map
