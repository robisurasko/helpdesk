{"version":3,"file":"TicketComment-1fc4a7d6.js","sources":["../../../../node_modules/mitt/dist/mitt.mjs","../../../../desk/src/emitter.ts","../../../../desk/src/pages/ticket/TicketComment.vue"],"sourcesContent":["export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","import mitt from \"mitt\";\n\nexport const emitter = mitt();\n","<template>\n  <div class=\"my-4 rounded border bg-cyan-50 p-4\">\n    <div class=\"mb-4 flex items-center justify-between\">\n      <div class=\"flex items-center gap-0.5 text-base\">\n        <UserAvatar v-bind=\"user\" size=\"lg\" expand strong />\n        <Icon icon=\"lucide:dot\" class=\"text-gray-500\" />\n        <Tooltip :text=\"dayjs(date).long()\">\n          <div class=\"text-gray-600\">\n            {{ dayjs.tz(date).fromNow() }}\n          </div>\n        </Tooltip>\n        <Icon v-if=\"isPinned\" icon=\"lucide:dot\" class=\"text-gray-500\" />\n        <Badge v-if=\"isPinned\" label=\"Pinned\" theme=\"blue\" variant=\"outline\" />\n      </div>\n      <div class=\"flex items-center gap-1\">\n        <Badge label=\"Comment\" theme=\"green\" variant=\"outline\" />\n        <Dropdown :options=\"options\">\n          <template #default>\n            <Button theme=\"gray\" variant=\"ghost\">\n              <template #icon>\n                <Icon icon=\"lucide:more-horizontal\" />\n              </template>\n            </Button>\n          </template>\n        </Dropdown>\n      </div>\n    </div>\n    <!-- eslint-disable-next-line vue/no-v-html -->\n    <span class=\"prose-f\" v-html=\"content\"></span>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { toRefs, h, computed } from \"vue\";\nimport { createResource, Badge, Button, Dropdown, Tooltip } from \"frappe-ui\";\nimport { Icon } from \"@iconify/vue\";\nimport { dayjs } from \"@/dayjs\";\nimport { emitter } from \"@/emitter\";\nimport { createToast } from \"@/utils\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { UserInfo } from \"@/types\";\nimport { UserAvatar } from \"@/components\";\n\ninterface P {\n  content: string;\n  date: string;\n  isPinned: number;\n  name: string;\n  user: UserInfo;\n}\n\nconst props = defineProps<P>();\nconst { content, name, isPinned, user } = toRefs(props);\nconst authStore = useAuthStore();\nconst IconTrash = h(Icon, { icon: \"lucide:trash-2\" });\nconst IconPin = h(Icon, { icon: \"lucide:pin\" });\nconst IconUnpin = h(Icon, { icon: \"lucide:pin-off\" });\nconst options = computed(() =>\n  [\n    {\n      label: isPinned.value ? \"Unpin\" : \"Pin\",\n      icon: isPinned.value ? IconUnpin : IconPin,\n      onClick: () => togglePin.submit(),\n    },\n    {\n      label: \"Delete\",\n      icon: IconTrash,\n      onClick: () => deleteComment.submit(),\n      isHidden: user.value.email !== authStore.userId,\n    },\n  ].filter((i) => !i.isHidden)\n);\n\nconst togglePin = createResource({\n  url: \"frappe.client.set_value\",\n  makeParams: () => ({\n    doctype: \"HD Ticket Comment\",\n    name: name.value,\n    fieldname: \"is_pinned\",\n    value: !isPinned.value,\n  }),\n  onSuccess: () => emitter.emit(\"update:ticket\"),\n});\n\nconst deleteComment = createResource({\n  url: \"frappe.client.delete\",\n  makeParams: () => ({\n    doctype: \"HD Ticket Comment\",\n    name: name.value,\n  }),\n  onSuccess() {\n    emitter.emit(\"update:ticket\");\n    createToast({\n      title: \"Comment deleted\",\n      icon: \"check\",\n      iconClasses: \"text-green-500\",\n    });\n  },\n});\n</script>\n"],"names":["mitt","t","e","i","n","emitter","props","__props","content","name","isPinned","user","toRefs","authStore","useAuthStore","IconTrash","h","Icon","IconPin","IconUnpin","options","computed","togglePin","deleteComment","createResource","createToast"],"mappings":"6iBAAe,SAAAA,EAAS,EAAE,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,IAAI,IAAI,GAAG,SAASC,EAAEC,EAAE,CAAC,IAAIC,EAAE,EAAE,IAAIF,CAAC,EAAEE,EAAEA,EAAE,KAAKD,CAAC,EAAE,EAAE,IAAID,EAAE,CAACC,CAAC,CAAC,CAAC,EAAE,IAAI,SAASD,EAAEC,EAAE,CAAC,IAAIC,EAAE,EAAE,IAAIF,CAAC,EAAEE,IAAID,EAAEC,EAAE,OAAOA,EAAE,QAAQD,CAAC,IAAI,EAAE,CAAC,EAAE,EAAE,IAAID,EAAE,EAAE,EAAE,EAAE,KAAK,SAASA,EAAEC,EAAE,CAAC,IAAIC,EAAE,EAAE,IAAIF,CAAC,EAAEE,GAAGA,EAAE,QAAQ,IAAI,SAASC,EAAE,CAACA,EAAEF,CAAC,CAAC,CAAC,GAAGC,EAAE,EAAE,IAAI,GAAG,IAAIA,EAAE,MAAO,EAAC,IAAI,SAASC,EAAE,CAACA,EAAEH,EAAEC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CCElT,MAAMG,EAAUL,EAAK,+TCiD5B,MAAMM,EAAQC,EACR,CAAE,QAAAC,EAAS,KAAAC,EAAM,SAAAC,EAAU,KAAAC,GAASC,EAAON,CAAK,EAChDO,EAAYC,IACZC,EAAYC,EAAEC,EAAM,CAAE,KAAM,iBAAkB,EAC9CC,EAAUF,EAAEC,EAAM,CAAE,KAAM,aAAc,EACxCE,EAAYH,EAAEC,EAAM,CAAE,KAAM,iBAAkB,EAC9CG,EAAUC,EAAS,IACvB,CACE,CACE,MAAOX,EAAS,MAAQ,QAAU,MAClC,KAAMA,EAAS,MAAQS,EAAYD,EACnC,QAAS,IAAMI,EAAU,OAAO,CAClC,EACA,CACE,MAAO,SACP,KAAMP,EACN,QAAS,IAAMQ,EAAc,OAAO,EACpC,SAAUZ,EAAK,MAAM,QAAUE,EAAU,MAC3C,GACA,OAAQV,GAAM,CAACA,EAAE,QAAQ,CAAA,EAGvBmB,EAAYE,EAAe,CAC/B,IAAK,0BACL,WAAY,KAAO,CACjB,QAAS,oBACT,KAAMf,EAAK,MACX,UAAW,YACX,MAAO,CAACC,EAAS,KAAA,GAEnB,UAAW,IAAML,EAAQ,KAAK,eAAe,CAAA,CAC9C,EAEKkB,EAAgBC,EAAe,CACnC,IAAK,uBACL,WAAY,KAAO,CACjB,QAAS,oBACT,KAAMf,EAAK,KAAA,GAEb,WAAY,CACVJ,EAAQ,KAAK,eAAe,EAChBoB,EAAA,CACV,MAAO,kBACP,KAAM,QACN,YAAa,gBAAA,CACd,CACH,CAAA,CACD","x_google_ignoreList":[0]}