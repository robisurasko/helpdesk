import{_ as Te}from"./plus-67bfab41.js";import{j as de,o as a,k as T,l as m,d as me,m as X,n as I,p as pe,r as $,f as D,w as f,g as r,q as fe,c as $e,s as ve,t as U,h as y,v as ne,x as ie,y as q,z as we,B as O,e as Y,D as K,E as Se,F as Le,G as De,H as Q,I as W,P as Me,J as Ne,u as Ae,K as k,L as E,M as V,T as Be,N as se,O as Re,Q as Fe,R as Ee,b as He,S as je,U as Pe,V as ae,W as re,X as ue}from"./index-6a3ac2ad.js";import{E as Ue,_ as Oe}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-60baa997.js";import{_ as ce,u as ze,I as qe}from"./ticketStatus-8544f784.js";import{I as Ie,u as Je,c as z}from"./useView-6d572c4e.js";import"./more-horizontal-14937468.js";import{d as B}from"./dayjs-a716d1bc.js";import{_ as Ze}from"./LayoutHeader-5106993c.js";import"./knowledgeBase-77ec454d.js";import{g as Ge}from"./globalStore-0321ecc2.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-b567f657.js";import"./label-90312d52.js";import"./StarRating.vue_vue_type_script_setup_true_lang-12029462.js";import"./Link-9287dea6.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-bce5a402.js";import"./Avatar.vue_vue_type_script_setup_true_lang-8ff52837.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-6aa45258.js";const Ke={},Qe={width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function We(d,c){return a(),T("svg",Qe,c[0]||(c[0]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.1783 0C3.89284 0 2.81689 0.974825 2.69042 2.25405L2.19257 7.2899C2.16724 7.54615 2.07636 7.79156 1.92869 8.00252L0.982801 9.35379C0.518857 10.0166 0.99301 10.9273 1.80203 10.9273H6.53506V13.4998C6.53506 13.776 6.75892 13.9998 7.03506 13.9998C7.31121 13.9998 7.53506 13.776 7.53506 13.4998V10.9273H12.2031C13.0121 10.9273 13.4863 10.0166 13.0223 9.35379L12.0695 7.99254C11.9251 7.78634 11.835 7.54713 11.8074 7.29695L11.2475 2.22567C11.1076 0.958818 10.0371 0 8.76259 0H5.1783ZM3.68557 2.35243C3.76145 1.5849 4.40702 1 5.1783 1H8.76259C9.52732 1 10.1696 1.57529 10.2535 2.3354L10.8134 7.40668C10.8594 7.82365 11.0097 8.22233 11.2502 8.566L12.2031 9.92725H1.80203L2.74793 8.57598C2.99404 8.22439 3.1455 7.81536 3.18772 7.38828L3.68557 2.35243Z",fill:"currentColor"},null,-1),m("rect",{x:"0.792893",width:"2",height:"17",rx:"1",transform:"rotate(-45 0.792893 0)",fill:"currentColor",class:"stroke stroke-ink-white"},null,-1)]))}const Xe=de(Ke,[["render",We]]),Ye={},et={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function tt(d,c){return a(),T("svg",et,c[0]||(c[0]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.17683 1C4.89138 1 3.81543 1.97482 3.68896 3.25405L3.19111 8.2899C3.16577 8.54615 3.0749 8.79156 2.92723 9.00252L1.98134 10.3538C1.51739 11.0166 1.99155 11.9273 2.80057 11.9273H7.53349V14.4999C7.53349 14.7761 7.75735 14.9999 8.03349 14.9999C8.30963 14.9999 8.53349 14.7761 8.53349 14.4999V11.9273H13.2016C14.0107 11.9273 14.4848 11.0166 14.0209 10.3538L13.068 8.99254C12.9236 8.78634 12.8335 8.54713 12.8059 8.29695L12.246 3.22567C12.1062 1.95882 11.0357 1 9.76113 1H6.17683ZM4.68411 3.35243C4.75999 2.5849 5.40556 2 6.17683 2H9.76113C10.5259 2 11.1682 2.57529 11.2521 3.3354L11.8119 8.40668C11.858 8.82365 12.0082 9.22233 12.2488 9.566L13.2016 10.9273H2.80057L3.74646 9.57598C3.99257 9.22439 4.14403 8.81536 4.18625 8.38828L4.68411 3.35243Z",fill:"currentColor"},null,-1)]))}const lt=de(Ye,[["render",tt]]),ot={class:"mt-3"},nt=me({__name:"ExportModal",props:X({rowCount:{}},{modelValue:{},modelModifiers:{}}),emits:X(["update"],["update:modelValue"]),setup(d,{emit:c}){const n=c,p=I(d,"modelValue"),v=pe({export_type:"Excel",export_all:!1});return(S,g)=>{const s=$("FormControl"),_=$("Button"),o=$("Dialog");return a(),D(o,{modelValue:p.value,"onUpdate:modelValue":g[3]||(g[3]=l=>p.value=l),options:{title:"Export"}},{"body-content":f(()=>[r(s,{modelValue:v.export_type,"onUpdate:modelValue":g[0]||(g[0]=l=>v.export_type=l),variant:"outline",label:"Export Type",type:"select",options:[{label:"Excel",value:"Excel"},{label:"CSV",value:"CSV"}],placeholder:"Excel"},null,8,["modelValue"]),m("div",ot,[r(s,{modelValue:v.export_all,"onUpdate:modelValue":g[1]||(g[1]=l=>v.export_all=l),type:"checkbox",label:`Export All ${S.rowCount} Record(s)`},null,8,["modelValue","label"])])]),actions:f(()=>[r(_,{label:"Download",variant:"solid",onClick:g[2]||(g[2]=()=>n("update",v)),class:"w-full"})]),_:1},8,["modelValue"])}}}),it={class:"flex items-center"},st=["onClick"],at={class:"flex items-center"},rt={class:"whitespace-nowrap"},ut={class:"flex flex-row-reverse gap-2 items-center min-w-11"},ct={__name:"ViewBreadcrumbs",props:{routeName:{type:String,required:!0},label:{type:String,required:!0},options:{type:Array,required:!0},dropdownActions:{type:Function,required:!0},currentView:{type:Object,required:!0}},setup(d){const c=fe(),{isMobileView:n}=$e(),p=v=>c.query.view?v.name===c.query.view:!1;return(v,S)=>{const g=$("router-link"),s=$("FeatherIcon"),_=$("Button");return a(),T("div",it,[r(g,{to:{name:d.routeName},class:"px-0.5 py-1 text-lg font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-5 hover:text-ink-gray-7 flex items-center justify-center"},{default:f(()=>[ve(U(y(n)?"...":d.label),1)]),_:1},8,["to"]),S[0]||(S[0]=m("span",{class:"mx-0.5 text-base text-ink-gray-4","aria-hidden":"true"}," / ",-1)),r(ce,{options:d.options},{default:f(({open:o})=>[r(_,{variant:"ghost",class:"text-lg font-medium text-nowrap",label:d.currentView.label},{prefix:f(()=>[typeof d.currentView.icon=="string"?(a(),D(y(Ie),{key:0,icon:d.currentView.icon,class:"h-4"},null,8,["icon"])):(a(),D(ne(d.currentView.icon),{key:1,class:"h-4 flex items-center justify-center"}))]),suffix:f(()=>[r(s,{name:o?"chevron-up":"chevron-down",class:"h-4 text-ink-gray-8"},null,8,["name"])]),_:2},1032,["label"])]),item:f(({item:o,active:l})=>[m("button",{class:ie(["group flex text-ink-gray-6 gap-4 h-7 w-full justify-between items-center rounded px-2 text-base",{"bg-surface-gray-3":l}]),onClick:o.onClick},[m("div",at,[o.icon&&typeof o.icon=="string"?(a(),D(s,{key:0,name:o.icon,class:"mr-2 h-4 w-4 flex-shrink-0 text-ink-gray-7","aria-hidden":"true"},null,8,["name"])):o.icon?(a(),D(ne(o.icon),{key:1,class:"mr-2 h-4 w-4 flex-shrink-0 text-ink-gray-7"})):q("",!0),m("span",rt,U(o.label),1)]),m("div",ut,[o.name?(a(),D(ce,{key:0,class:ie(l?"block":"hidden"),placement:"right-start",options:d.dropdownActions(o)},{default:f(({togglePopover:h})=>[r(_,{variant:"ghost",class:"!size-5",icon:"more-horizontal",onClick:we(C=>h(),["stop"])},null,8,["onClick"])]),_:2},1032,["class","options"])):q("",!0),p(o)?(a(),D(s,{key:1,name:"check",class:"size-4 text-ink-gray-7"})):q("",!0)])],10,st)]),_:1},8,["options"])])}}},dt={class:"text-base"},mt={key:0,class:"px-2 py-1 flex items-center justify-center gap-2 rounded-full bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},pt=["onClick"],ft={key:1,class:"my-3 max-w-max transform bg-surface-white px-4 sm:px-0"},vt={class:"relative max-h-96 pb-3 overflow-y-auto min-w-40 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},wt={class:"flex gap-2 px-3 pb-1 pt-3"},gt={class:"flex-1"},bt={class:"sticky top-0 bg-surface-modal pb-2 pt-3 text-sm text-ink-gray-7"},kt={class:"grid w-96 grid-cols-12 place-items-center"},yt=["onClick","title"],_t={__name:"IconPicker",props:{modelValue:{},modelModifiers:{},reaction:{},reactionModifiers:{}},emits:["update:modelValue","update:reaction"],setup(d,{expose:c}){const n=O(""),p=I(d,"modelValue"),v=I(d,"reaction"),S=O(["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™"]),g=Y(()=>{let o={};for(let l of K){if(n.value&&![l.description,...l.names,...l.tags].join(" ").toLowerCase().includes(n.value.toLowerCase()))continue;let h=o[l.category];h||(o[l.category]=[],h=o[l.category]),h.push(l)}return Object.keys(o).length||(o["No results"]=[]),o});function s(){let o=K.length,l=_(0,o-1);p.value=K[l].emoji}function _(o,l){return Math.floor(Math.random()*(l-o+1)+o)}return c({setRandom:s}),(o,l)=>{const h=$("Button"),C=$("FormControl");return a(),D(y(Me),{transition:"default"},{target:f(({togglePopover:M,isOpen:L})=>[Se(o.$slots,"default",Le(De({isOpen:L,togglePopover:M})),()=>[m("span",dt,U(d.modelValue||""),1)])]),body:f(({togglePopover:M})=>[v.value?(a(),T("div",mt,[(a(!0),T(Q,null,W(S.value,L=>(a(),T("div",{class:"size-5 cursor-pointer rounded-full bg-surface-transparent text-xl",key:L,onClick:()=>(p.value=L)&&M()},[m("button",null,U(L),1)],8,pt))),128)),r(h,{class:"rounded-full",icon:"plus",onClick:l[0]||(l[0]=we(()=>v.value=!1,["stop"]))})])):(a(),T("div",ft,[m("div",vt,[m("div",wt,[m("div",gt,[r(C,{type:"text",placeholder:"Search by keyword",modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=L=>n.value=L),debounce:300},null,8,["modelValue"])]),r(h,{onClick:s},{default:f(()=>l[2]||(l[2]=[ve("Random")])),_:1})]),l[3]||(l[3]=m("div",{class:"w-96"},null,-1)),(a(!0),T(Q,null,W(g.value,(L,N)=>(a(),T("div",{class:"px-3",key:N},[m("div",bt,U(N),1),m("div",kt,[(a(!0),T(Q,null,W(L,H=>(a(),T("button",{class:"h-8 w-8 rounded-md p-1 text-2xl hover:bg-surface-gray-2 focus:outline-none focus:ring focus:ring-blue-200",key:H.description,onClick:()=>(p.value=H.emoji)&&M(),title:H.description},U(H.emoji),9,yt))),128))])]))),128))])]))]),_:3})}}},ht={class:"flex gap-2"},Ct={__name:"ViewModal",props:{modelValue:{},modelModifiers:{}},emits:X(["update"],["update:modelValue"]),setup(d,{emit:c}){let n=I(d,"modelValue");const p=O({label:n.value.view.label||"",icon:n.value.view.icon||"",name:n.value.view.name||""}),v=Y(()=>({modalTitle:n.value.mode==="edit"?"Edit View":n.value.mode==="duplicate"?"Duplicate View":"Create View",buttonLabel:n.value.mode==="edit"?"Update":n.value.mode==="duplicate"?"Duplicate":"Create",action:n.value.mode==="edit"?"update":n.value.mode==="duplicate"?"duplicate":"create"})),S=c;return(g,s)=>{const _=$("Button"),o=$("FormControl");return a(),D(y(Ne),{modelValue:y(n).show,"onUpdate:modelValue":s[3]||(s[3]=l=>y(n).show=l),options:{title:v.value.modalTitle}},{"body-content":f(()=>[s[4]||(s[4]=m("div",{class:"mb-1.5 block text-base text-ink-gray-5"},"View Name",-1)),m("div",ht,[r(_t,{modelValue:p.value.icon,"onUpdate:modelValue":s[0]||(s[0]=l=>p.value.icon=l)},{default:f(({togglePopover:l})=>[r(_,{size:"md",class:"flex size-8 text-2xl leading-none",label:p.value.icon,onClick:l},null,8,["label","onClick"])]),_:1},8,["modelValue"]),r(o,{class:"flex-1",size:"md",type:"text",placeholder:"My Open Tickets",modelValue:p.value.label,"onUpdate:modelValue":s[1]||(s[1]=l=>p.value.label=l)},null,8,["modelValue"])])]),actions:f(()=>[r(_,{label:v.value.buttonLabel,variant:"solid",onClick:s[2]||(s[2]=l=>S("update",p.value,v.value.action)),class:"w-full"},null,8,["label"])]),_:1},8,["modelValue","options"])}}},Ut=me({__name:"Tickets",setup(d){const c=He(),n=fe(),{getCurrentUserViews:p,createView:v,publicViews:S,pinnedViews:g,findView:s,updateView:_,deleteView:o}=Je("HD Ticket"),{$dialog:l}=Ge(),{isManager:h}=Ae(),C=O(null),M=O(!1),{textColorMap:L}=ze(),N=O(new Set),H=[{label:"Export",icon:"download",onClick:t=>{N.value=new Set(t),M.value=!0}},{label:"Delete",icon:"trash-2",onClick:t=>{N.value=new Set(t),l({title:"Delete Ticket(s)?",message:"Are you sure you want to delete these ticket(s)?",actions:[{label:"Confirm",variant:"solid",onClick(e){ge(e),e()}}]})},condition:()=>!V.value&&h}];function ge(t){je("bulk_delete"),Pe("frappe.desk.reportview.delete_items",{items:JSON.stringify(Array.from(N.value)),doctype:"HD Ticket"}).then(()=>{ae({title:"Deleted successfully",icon:"check",iconClasses:"text-ink-green-3"}),t(),ee(!0)})}const be={doctype:"HD Ticket",columnConfig:{status:{prefix:({row:t})=>k(qe,{class:L[t.status]})},agreement_status:{custom:({item:t})=>k(E,{label:t,theme:he[t],variant:"outline"})},response_by:{custom:({row:t,item:e})=>ke(t,e)},resolution_by:{custom:({row:t,item:e})=>ye(t,e)}},isCustomerPortal:V.value,selectable:!0,showSelectBanner:!0,selectBannerActions:H,emptyState:{title:"No Tickets Found",icon:k(Be,{class:"h-10 w-10"})},rowRoute:{name:V.value?"TicketCustomer":"TicketAgent",prop:"ticketId"},hideColumnSetting:!1};function ke(t,e){return!t.first_responded_on&&B(e).isBefore(new Date)?k(E,{label:"Failed",theme:"red",variant:"outline"}):t.first_responded_on&&B(t.first_responded_on).isBefore(e)?k(E,{label:"Fulfilled",theme:"green",variant:"outline"}):B(t.first_responded_on).isAfter(e)?k(E,{label:"Failed",theme:"red",variant:"outline"}):k(se,{text:B(e).long()},()=>B.tz(e).fromNow())}function ye(t,e){return t.status==="Replied"?k(E,{label:"Paused",theme:"blue",variant:"outline"}):t.resolution_date&&B(t.resolution_date).isBefore(e)?k(E,{label:"Fulfilled",theme:"green",variant:"outline"}):B(t.resolution_date).isAfter(e)?k(E,{label:"Failed",theme:"red",variant:"outline"}):k(se,{text:B(e).long()},()=>B.tz(e).fromNow())}async function _e(t="Excel",e=!1){var F;const i=(F=C.value)==null?void 0:F.list;if(!i)return;const w=JSON.stringify(i.data.columns.map(b=>b.key)),R=i.params.order_by;let x={...i.params.filters},A;e?(x=JSON.stringify(x),A=i.data.total_count):(A=N.value.size,x.name=["in",Array.from(N.value)],x=JSON.stringify(x)),window.location.href=`/api/method/frappe.desk.reportview.export_query?file_format_type=${t}&title=HD Ticket&doctype=HD Ticket&fields=${w}&filters=${x}&order_by=${R}&page_length=${A}&start=0&view=Report&with_comment_count=1`,ee(),M.value=!1}function ee(t=!1){var e,i;(e=C.value)==null||e.unselectAll(),(i=N.value)==null||i.clear(),t&&C.value.reload()}const he={Fulfilled:"green",Failed:"red","Resolution Due":"orange","First Response Due":"orange",Paused:"blue"};let u=pe({show:!1,view:{label:"",icon:"",name:""},mode:"create"});const Ce=Y(()=>{var e,i,w;const t=[{group:"Default Views",items:[{label:"List View",icon:"align-justify",onClick:()=>c.push({name:V.value?"TicketsCustomer":"TicketsAgent"})}]}];return((e=p.value)==null?void 0:e.length)!==0&&t.push({group:"Saved Views",items:J(p.value)}),((i=g.value)==null?void 0:i.length)!==0&&t.push({group:"Private Views",items:J(g.value)}),((w=S.value)==null?void 0:w.length)!==0&&t.push({group:"Public Views",items:J(S.value)}),t.push({group:"Create View",hideLabel:!0,items:[{label:"Create View",icon:"plus",onClick:()=>{te(),u.show=!0}}]}),t});let j=null;const xe=t=>{const e=s(t.name).value;let i=[{group:"Default Views",hideLabel:!0,items:[{label:"Duplicate",icon:k(re,{name:"copy"}),onClick:()=>{u.view.label=e.label+" (New)",u.view.icon=e.icon,u.view.name=e.name,u.mode="duplicate",j=e,u.show=!0}}]}];return(!e.public||h)&&(i[0].items.push({label:"Edit",icon:k(Ue,{class:"h-4 w-4"}),onClick:()=>{u.view.label=e.label,u.view.icon=e.icon,u.view.name=e.name,u.mode="edit",u.show=!0}}),e.public||i[0].items.push({label:e!=null&&e.pinned?"Unpin View":"Pin View",icon:k(e!=null&&e.pinned?Xe:lt,{class:"h-4 w-4"}),onClick:()=>{const w={name:e.name};w.pinned=!e.pinned,_(w)}}),h&&!V.value&&i[0].items.push({label:e!=null&&e.public?"Make Private":"Make Public",icon:k(re,{name:e!=null&&e.public?"lock":"unlock",class:"h-4 w-4"}),onClick:()=>{const w={name:e.name,public:!e.public};e.public?l({title:`Make ${e.label} private?`,message:"This view is currently public. Changing it to private will hide it for all the users.",actions:[{label:"Confirm",variant:"solid",onClick(R){R(),_(w)}}]}):_(w)}}),i.push({group:"Delete View",hideLabel:!0,items:[{label:"Delete",icon:"trash-2",onClick:()=>{l({title:`Delete ${e.label}?`,message:`Are you sure you want to delete this view?
              ${e.public?"This view is public, and will be removed for all users.":""}`,actions:[{label:"Confirm",variant:"solid",onClick(w){n.query.view===e.name&&c.push({name:V.value?"TicketsCustomer":"TicketsAgent"}),o(e.name),Z("deleted"),w()}}]})}}]})),i};function J(t){return t==null?void 0:t.map(e=>({...e,onClick:()=>{z.value={label:e.label,icon:e.icon},c.push({name:e.route_name,query:{view:e.name}})}}))}function Ve(t,e){var w,R,x,A,F,b,P,le,oe;let i;if(e==="update"){_(t),Z("updated"),z.value={label:t.label,icon:ue(t.icon)};return}else e==="duplicate"?i={...j,filters:JSON.stringify(j.filters),columns:JSON.stringify(j.columns),rows:JSON.stringify(j.rows),label:t.label,icon:t.icon,public:!1,pinned:!1}:i={dt:"HD Ticket",type:"list",label:t.label??"List",icon:t.icon??"",route_name:c.currentRoute.value.name,order_by:(R=(w=C.value)==null?void 0:w.list)==null?void 0:R.params.order_by,filters:JSON.stringify((A=(x=C.value)==null?void 0:x.list)==null?void 0:A.params.filters),columns:JSON.stringify((b=(F=C.value)==null?void 0:F.list)==null?void 0:b.data.columns),rows:JSON.stringify((oe=(le=(P=C.value)==null?void 0:P.list)==null?void 0:le.data)==null?void 0:oe.rows),is_customer_portal:V.value};v(i,G=>{z.value={label:G.label||"List",icon:ue(G.icon)},c.push({name:V.value?"TicketsCustomer":"TicketsAgent",query:{view:G.name}}),Z()})}function Z(t="created"){ae({title:`View ${t} successfully`,icon:"check",iconClasses:"text-green-600"}),te()}function te(){u.show=!1,u.view.label="",u.view.icon="",u.view.name="",u.mode=null,j=null}return Re(()=>{n.query.view||(z.value={label:"List",icon:"lucide:align-justify"})}),Fe(()=>({title:"Tickets"})),(t,e)=>{var x,A,F;const i=Te,w=$("Button"),R=$("RouterLink");return a(),T("div",null,[r(y(Ze),null,{"left-header":f(()=>[r(ct,{label:"Tickets","route-name":y(V)?"TicketsCustomer":"TicketsAgent",options:Ce.value,"dropdown-actions":xe,"current-view":y(z)},null,8,["route-name","options","current-view"])]),"right-header":f(()=>[r(R,{to:{name:y(V)?"TicketNew":"TicketAgentNew"}},{default:f(()=>[r(w,{label:"Create",theme:"gray",variant:"solid"},{prefix:f(()=>[r(i,{class:"h-4 w-4"})]),_:1})]),_:1},8,["to"])]),_:1}),r(y(Oe),{ref_key:"listViewRef",ref:C,options:be,onEmptyStateAction:e[0]||(e[0]=()=>t.$router.push({name:y(V)?"TicketNew":"TicketAgentNew"})),onRowClick:e[1]||(e[1]=b=>t.$router.push({name:y(V)?"TicketCustomer":"TicketAgent",params:{ticketId:b}}))},null,512),r(nt,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=b=>M.value=b),rowCount:((F=(A=(x=t.$refs.listViewRef)==null?void 0:x.list)==null?void 0:A.data)==null?void 0:F.total_count)??0,onUpdate:e[3]||(e[3]=({export_type:b,export_all:P})=>_e(b,P))},null,8,["modelValue","rowCount"]),y(u).show?(a(),D(Ct,{key:0,modelValue:y(u),"onUpdate:modelValue":e[4]||(e[4]=b=>Ee(u)?u.value=b:u=b),onUpdate:e[5]||(e[5]=(b,P)=>Ve(b,P))},null,8,["modelValue"])):q("",!0)])}}});export{Ut as default};
//# sourceMappingURL=Tickets-02c5f549.js.map
