import{s as Z,p as G,_ as J,h as W,a as X}from"./formCustomisation-8108f583.js";import{d as P,e as y,K as b,Y as z,Z as B,o as c,k as v,l as f,s as H,t as ee,y as h,f as F,v as te,B as V,p as ae,$ as le,M as x,S as j,Q as se,u as oe,O as ne,g,w as T,h as o,H as ie,I as re,x as de,a0 as q,a1 as A,q as ue,b as ce,a2 as L,U as me}from"./index-14da1b96.js";import{_ as pe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-33e19da6.js";import{g as fe}from"./globalStore-bd2d7230.js";import{s as M}from"./index-83df9f82.js";import"./useView-c256aa2e.js";import"./more-horizontal-4b0bead1.js";import"./dayjs-1848fb71.js";import"./knowledgeBase-b86a51f6.js";import{_ as I}from"./Autocomplete-252858b8.js";import{_ as ve}from"./Link-e283dcda.js";import{_ as he}from"./LayoutHeader-3516895f.js";import{_ as _e}from"./SearchArticles.vue_vue_type_script_setup_true_lang-1a38e536.js";import{_ as O}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-618fc8ac.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-608b497a.js";import"./FileUploader-b9a0914f.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-3d6f0e25.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-c18f002f.js";import"./Avatar.vue_vue_type_script_setup_true_lang-31924be6.js";const ge={key:0,class:"space-y-1.5"},ke={class:"block text-sm text-gray-700"},ye={key:0,class:"place-self-center text-red-500"},be=P({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(N,{emit:C}){const s=N,w=C,U=y(()=>s.field.url_method?b(I,{options:d.data}):s.field.fieldtype==="Link"&&s.field.options?b(ve,{doctype:s.field.options,filters:s.field.filters}):s.field.fieldtype==="Select"?b(I,{options:s.field.options.split(`
`).map(l=>({label:l,value:l}))}):s.field.fieldtype==="Check"?b(I,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):b(z,{debounce:500})),d=B({url:s.field.url_method,auto:!!s.field.url_method,transform:l=>l.map(m=>({label:m,value:m}))}),r=y(()=>s.field.fieldtype==="Check"?s.value?"Yes":"No":s.value),_=y(()=>s.field.fieldtype==="Data"&&!s.field.url_method?"Type something":"Select an option");function u(l,m){w("change",{fieldname:l,value:m})}return(l,m)=>l.field.display_via_depends_on?(c(),v("div",ge,[f("span",ke,[H(ee(l.field.label)+" ",1),l.field.required?(c(),v("span",ye," * ")):h("",!0)]),(c(),F(te(U.value),{placeholder:_.value,value:r.value,"model-value":r.value,"onUpdate:modelValue":m[0]||(m[0]=p=>u(l.field.fieldname,p)),onChange:m[1]||(m[1]=p=>{var $;return u(l.field.fieldname,(($=p.target)==null?void 0:$.value)||p.value||p)})},null,40,["placeholder","value","model-value"]))])):h("",!0)}}),xe={class:"flex flex-col overflow-y-auto"},Ce={class:"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5"},we={key:0,class:""},$e=["innerHTML"],Se={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Te={class:"flex flex-col gap-2"},Fe={key:1},Ne={class:"text-p-sm text-gray-500 ml-1"},Ue={key:2},Ge=P({__name:"TicketNew",props:{templateId:{default:""}},setup(N){const C=N,s=ue(),w=ce(),{$dialog:U}=fe(),d=V(""),r=V(""),_=V([]),u=ae({}),l=B({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:C.templateId||"Default"}),auto:!0,transform:e=>{Z(e,{doc:u,call:me,router:w,$dialog:U,applyFilters:$}),m(e.fields)},onSuccess:e=>{r.value=e.description_template||"",p=window.structuredClone(e.fields||[])}});function m(e){e.forEach(t=>{u[t.fieldname]=""})}let p=[];function $(e,t=null){const n=l.data.fields.find(i=>i.fieldname===e);n&&(n.fieldtype==="Select"?W(n,e,t,u,p):n.fieldtype==="Link"&&X(n,e,t,u,p))}const R=y(()=>{var e;return(e=l.data)==null?void 0:e._customOnChange}),D=y(()=>{var t,n;let e=(n=(t=l.data)==null?void 0:t.fields)==null?void 0:n.filter(i=>s.meta.agent||!i.hide_from_customer);return e?e.map(i=>G(i,u)):[]});function Y(e,t,n){var a;u[t]=e.value;const i=(a=R.value)==null?void 0:a[t];i&&i.forEach(k=>{k(e.value,n)})}const S=B({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:r.value,subject:d.value,template:C.templateId,...u},attachments:_.value}),validate:e=>{var i;const n=[...((i=D.value)==null?void 0:i.filter(a=>a.required))||[],"subject","description"];for(const a of n)if(le.isEmpty(e.doc[a.fieldname||a]))return`${a.label||a} is required`},onSuccess:e=>{w.push({name:x.value?"TicketCustomer":"TicketAgent",params:{ticketId:e.name}}),x.value&&j("new_ticket_submitted",{data:{user:E,ticketID:e.name,subject:d.value,description:r.value,customFields:u}})}});function K(e){return M(e,{allowedTags:M.defaults.allowedTags.concat(["img"])})}const Q=y(()=>[{label:"Tickets",route:{name:"TicketsCustomer"}},{label:"New Ticket",route:{name:"TicketNew"}}]);se(()=>({title:"New Ticket"}));const{userId:E}=oe();return ne(()=>{j("new_ticket_page",{data:{user:E}})}),(e,t)=>{var i;const n=J;return c(),v("div",xe,[g(o(he),null,{"left-header":T(()=>[g(o(pe),{items:Q.value},null,8,["items"])]),"right-header":T(()=>{var a,k;return[(a=o(l).data)!=null&&a._customActions?(c(),F(n,{key:0,actions:(k=o(l).data)==null?void 0:k._customActions},null,8,["actions"])):h("",!0)]}),_:1}),f("div",Ce,[(i=o(l).data)!=null&&i.about?(c(),v("div",we,[f("div",{class:"prose-f",innerHTML:K(o(l).data.about)},null,8,$e)])):h("",!0),D.value?(c(),v("div",Se,[(c(!0),v(ie,null,re(D.value,a=>(c(),F(o(be),{key:a.fieldname,field:a,value:u[a.fieldname],onChange:k=>Y(k,a.fieldname,a.fieldtype)},null,8,["field","value","onChange"]))),128))])):h("",!0),f("div",{class:de(["flex flex-col",(d.value.length>=2||r.value.length)&&"gap-5"])},[f("div",Te,[t[7]||(t[7]=f("span",{class:"block text-sm text-gray-700"},[H(" Subject "),f("span",{class:"place-self-center text-red-500"}," * ")],-1)),g(o(z),{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),type:"text",placeholder:"A short description"},null,8,["modelValue"])]),o(x)?(c(),F(_e,{key:0,query:d.value,class:"shadow"},null,8,["query"])):h("",!0),o(x)?(c(),v("div",Fe,[q(f("h4",Ne," Please enter a subject to continue ",512),[[A,d.value.length<=2&&r.value.length===0]]),q(g(O,{ref:"editor",attachments:_.value,"onUpdate:attachments":t[2]||(t[2]=a=>_.value=a),content:r.value,"onUpdate:content":t[3]||(t[3]=a=>r.value=a),placeholder:"Detailed explanation",expand:""},{"bottom-right":T(()=>[g(o(L),{label:"Submit",theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||o(S).loading||!d.value,onClick:t[1]||(t[1]=()=>o(S).submit())},null,8,["disabled"])]),_:1},8,["attachments","content"]),[[A,d.value.length>2||r.value.length>0]])])):h("",!0)],2),o(x)?h("",!0):(c(),v("div",Ue,[g(O,{ref:"editor",attachments:_.value,"onUpdate:attachments":t[5]||(t[5]=a=>_.value=a),content:r.value,"onUpdate:content":t[6]||(t[6]=a=>r.value=a),placeholder:"Detailed explanation",expand:""},{"bottom-right":T(()=>[g(o(L),{label:"Submit",theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||o(S).loading||!d.value,onClick:t[4]||(t[4]=()=>o(S).submit())},null,8,["disabled"])]),_:1},8,["attachments","content"])]))])])}}});export{Ge as default};
//# sourceMappingURL=TicketNew-25424fe7.js.map
