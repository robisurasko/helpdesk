import{_ as K}from"./plus-67bfab41.js";import{j as T,o as C,k as I,l as v,aV as Q,ap as j,e as k,d as S,B as b,Z as X,V as $,r as F,g as f,w,H as q,I as G,t as M,f as U,h as u,b2 as L,b0 as z,b3 as Z,b4 as O,J as A,aX as W,a7 as Y,b1 as ee,y as H,K as te,Q as ae}from"./index-6a3ac2ad.js";import{_ as J}from"./Avatar.vue_vue_type_script_setup_true_lang-8ff52837.js";import"./useView-6d572c4e.js";import"./more-horizontal-14937468.js";import"./dayjs-a716d1bc.js";import{_ as oe}from"./LayoutHeader-5106993c.js";import"./knowledgeBase-77ec454d.js";import{_ as le}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-60baa997.js";import{F as ne}from"./FileUploader-237fbae7.js";import{_ as se}from"./Pill-1825f2a6.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-b567f657.js";import"./label-90312d52.js";import"./StarRating.vue_vue_type_script_setup_true_lang-12029462.js";import"./Link-9287dea6.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-bce5a402.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-6aa45258.js";const ie={},re={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ue(y,c){return C(),I("svg",re,c[0]||(c[0]=[v("path",{d:"M10.381 15.0091L13.0108 12.8044C13.3009 12.5612 13.7186 12.5445 14.0272 12.7639L16.5838 14.5815C17.0394 14.9054 17.0522 15.5775 16.6093 15.9186L15.6001 16.6955C14.9561 17.1913 14.0933 17.2956 13.3711 16.9225C11.824 16.1231 9.08016 14.5487 7.11025 12.5456C5.21236 10.6158 3.81881 8.0839 3.08578 6.57321C2.70649 5.79154 2.88609 4.87094 3.48778 4.24418L4.42402 3.26893C4.7989 2.87842 5.441 2.94435 5.72871 3.40288L7.34325 5.976C7.55012 6.3057 7.50072 6.73477 7.22432 7.00882L4.62919 9.58191",stroke:"currentColor","stroke-linejoin":"round"},null,-1)]))}const ce=T(ie,[["render",ue]]),me=Q("contact",()=>{const y=j({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:k(()=>{var r;return((r=y.list)==null?void 0:r.data)||[]})}}),de={class:"space-y-4"},pe={class:"mb-2 block text-sm leading-4 text-gray-700"},ve={class:"flex justify-end space-x-2"},fe=S({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(y,{emit:c}){const r=y,_=c,p=me(),t=b({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:""}),s=b({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),i=[{label:"Email Id",value:"emailID",error:"emailValidationError",type:"input",action:()=>a(t.value.emailID)},{label:"First Name",value:"firstName",error:"firstNameValidationError",type:"input",action:()=>o(t.value.firstName)},{label:"Last Name",value:"lastName",error:"lastNameValidationError",type:"input"},{label:"Phone",value:"phone",error:"phoneValidationError",type:"input",action:()=>h(t.value.phone)},{label:"Customer",value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",action:()=>D(t.value.selectedCustomer)}],g=k({get:()=>r.modelValue,set:e=>{_("update:modelValue",e),e||_("close")}}),l=j({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(m=>({label:m.name,value:m.name})),auto:!0}),n=X({url:"frappe.client.insert",onSuccess:()=>{t.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:""},$({title:"Contact Created Successfully ",icon:"check",iconClasses:"text-green-600"}),_("contactCreated")}});function E(){if(x())return;let e={doctype:"Contact",first_name:t.value.firstName,last_name:t.value.lastName,email_ids:[{email_id:t.value.emailID,is_primary:!0}],links:[{link_doctype:"HD Customer",link_name:t.value.selectedCustomer}],phone_nos:[]};t.value.phone&&(e.phone_nos=[{phone:t.value.phone}]),n.submit({doc:e})}function B(e){e&&(t.value.selectedCustomer=e.value)}function x(){let e=a(t.value.emailID);return e+=o(t.value.firstName),e+=h(t.value.phone),e+=D(t.value.selectedCustomer),e}function a(e){s.value.emailValidationError="";const m=L.string().email().safeParse(e).success;return e?m?P(p.options).includes(e)&&(s.value.emailValidationError="Contact with email already exists"):s.value.emailValidationError="Enter a valid email":s.value.emailValidationError="Email should not be empty",s.value.emailValidationError}function o(e){return s.value.firstNameValidationError="",(!e||e.trim()==="")&&(s.value.firstNameValidationError="First name should not be empty"),s.value.firstNameValidationError}function h(e){return s.value.phoneValidationError="",e&&(!/[0-9]+/.test(e)||e.length<10)&&(s.value.phoneValidationError="Enter a valid phone number"),s.value.phoneValidationError}function D(e){return s.value.customerValidationError="",(!e||e.trim()==="")&&(s.value.customerValidationError="Customer should not be empty"),s.value.customerValidationError}function P(e){return e.map(m=>m.email_id)}return(e,m)=>{const V=F("Button");return C(),I("div",null,[f(u(A),{modelValue:g.value,"onUpdate:modelValue":m[1]||(m[1]=d=>g.value=d),options:{title:"Create New Contact"}},{"body-content":w(()=>[v("div",de,[(C(),I(q,null,G(i,d=>v("div",{key:d.label,class:"flex flex-col gap-1"},[v("span",pe,M(d.label),1),d.type==="input"?(C(),U(u(z),{key:0,modelValue:t.value[d.value],"onUpdate:modelValue":N=>t.value[d.value]=N,type:"text",onBlur:d.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(C(),U(u(Z),{key:1,modelValue:t.value[d.value],"onUpdate:modelValue":[N=>t.value[d.value]=N,B],options:u(l).data,value:t.value[d.value]},null,8,["modelValue","onUpdate:modelValue","options","value"])),f(u(O),{message:s.value[d.error]},null,8,["message"])])),64)),v("div",ve,[f(V,{label:"Create",loading:u(n).loading,theme:"gray",variant:"solid",onClick:m[0]||(m[0]=d=>E())},null,8,["loading"])])])]),_:1},8,["modelValue"])])}}}),_e={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},R=S({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(y,{emit:c}){const r=y,_=c,{items:p}=W(r),t=b("");function s(g){const l=r.validate(g);if(l){$({title:l,icon:"x",iconClasses:"text-red-500"});return}const n=[...p.value,g];_("update:items",n),t.value=""}function i(g){const l=p.value.filter(n=>n.value!==g);_("update:items",l)}return(g,l)=>(C(),I("div",_e,[(C(!0),I(q,null,G(u(p),n=>(C(),U(se,{key:n.value,label:n.label,onClick:l[0]||(l[0]=E=>i(E))},null,8,["label"]))),128)),f(u(z),{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=n=>t.value=n),class:"w-full",placeholder:y.placeholder,onKeyup:l[2]||(l[2]=Y(n=>s({label:t.value,value:t.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),ge={class:"flex flex-col items-center gap-4 p-6"},Ce={class:"text-xl font-medium text-gray-900"},he={class:"flex gap-2"},ye={class:"w-full space-y-2 text-sm text-gray-700"},Ve={class:"space-y-1"},xe={class:"space-y-1"},be=S({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(y,{emit:c}){const r=y,_=c,p=b(!1),t=k({get(){var o;return(((o=i.doc)==null?void 0:o.email_ids)||[]).map(h=>({label:h.email_id,value:h.email_id}))},set(a){if(a.length===0){$({title:"At least one email is required",icon:"x",iconClasses:"text-red-600"});return}a.length!==i.doc.email_ids.length&&(p.value=!0),i.doc.email_ids=a.map(o=>({email_id:o.value}))}}),s=k({get(){var o;return(((o=i.doc)==null?void 0:o.phone_nos)||[]).map(h=>({label:h.phone,value:h.phone}))},set(a){a.length!==i.doc.phone_nos.length&&(p.value=!0),i.doc.phone_nos=a.map(o=>({phone:o.value}))}}),i=ee({doctype:"Contact",name:r.name,cache:[`contact-${r.name}`,r.name],auto:!0,setValue:{onSuccess(){_("contactUpdated")}}}),g=k(()=>{var a;return{title:(a=i.doc)==null?void 0:a.name,actions:[{label:"Save",theme:"gray",variant:"solid",onClick:()=>l()}]}});function l(){if(!p.value){$({title:"No changes to save",icon:"x",iconClasses:"text-red-600"});return}i.setValue.submit({email_ids:t.value.map(a=>({email_id:a.value,is_primary:a.value===i.doc.email_id})),phone_nos:s.value.map(a=>({phone:a.value,is_primary_phone:a.value===i.doc.phone,is_primary_mobile:a.value===i.doc.phone}))})}function n(a){i.setValue.submit({image:(a==null?void 0:a.file_url)||null}),p.value=!0}function E(a){if(!L.string().email().safeParse(a.value).success)return"Invalid email"}function B(a){if(!L.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(a.value).success)return"Invalid phone number"}function x(a){let o=a.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(o))return $({title:"Invalid file type, only PNG and JPG images are allowed",icon:"x",iconClasses:"text-red-600"}),"Invalid file type, only PNG and JPG images are allowed"}return(a,o)=>{const h=F("Button");return C(),U(u(A),{options:g.value},{"body-main":w(()=>{var D,P,e,m;return[v("div",ge,[v("div",Ce,M((D=u(i).doc)==null?void 0:D.name),1),f(u(J),{size:"2xl",label:(P=u(i).doc)==null?void 0:P.name,image:(e=u(i).doc)==null?void 0:e.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),v("div",he,[f(u(ne),{"validate-file":x,onSuccess:o[0]||(o[0]=V=>n(V))},{default:w(({uploading:V,openFileSelector:d})=>{var N;return[f(h,{label:(N=u(i).doc)!=null&&N.image?"Change photo":"Upload photo",loading:V,onClick:d},null,8,["label","loading","onClick"])]}),_:1}),(m=u(i).doc)!=null&&m.image?(C(),U(h,{key:0,label:"Remove photo",onClick:o[1]||(o[1]=V=>n(null))})):H("",!0)]),v("div",ye,[v("div",Ve,[o[4]||(o[4]=v("div",{class:"text-xs"},"Emails",-1)),f(R,{items:t.value,"onUpdate:items":o[2]||(o[2]=V=>t.value=V),placeholder:"john.doe@example.com",validate:E},null,8,["items"])]),v("div",xe,[o[5]||(o[5]=v("div",{class:"text-xs"},"Phone Nos",-1)),f(R,{items:s.value,"onUpdate:items":o[3]||(o[3]=V=>s.value=V),placeholder:"+91 98765 43210",validate:B},null,8,["items"])])])])]}),_:1},8,["options"])}}}),Ee={class:"flex flex-col"},ze=S({__name:"Contacts",setup(y){const c=b(!1),r=b(!1),_=b(null),p=b(null),t=k(()=>({doctype:"Contact",columnConfig:{full_name:{prefix:({row:l})=>te(J,{shape:"circle",image:l.image,label:l.name,size:"sm"})},mobile_no:{prefix:ce}},emptyState:{title:"No Contacts Found"}}));function s(){var l;c.value=!1,(l=p.value)==null||l.reload()}function i(l){_.value=l,r.value=!0}function g(){var l;$({title:"Contact updated",icon:"check",iconClasses:"text-green-500"}),r.value=!r.value,(l=p.value)==null||l.reload()}return ae(()=>({title:"Contacts"})),(l,n)=>{const E=K,B=F("Button");return C(),I("div",Ee,[f(u(oe),null,{"left-header":w(()=>n[4]||(n[4]=[v("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])),"right-header":w(()=>[f(B,{label:"New contact",theme:"gray",variant:"solid",onClick:n[0]||(n[0]=x=>c.value=!c.value)},{prefix:w(()=>[f(E,{class:"h-4 w-4"})]),_:1})]),_:1}),f(u(le),{ref_key:"listViewRef",ref:p,options:t.value,onRowClick:i,onEmptyStateAction:n[1]||(n[1]=x=>c.value=!0)},null,8,["options"]),f(fe,{modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=x=>c.value=x),onContactCreated:s},null,8,["modelValue"]),r.value?(C(),U(be,{key:_.value,modelValue:r.value,"onUpdate:modelValue":n[3]||(n[3]=x=>r.value=x),name:_.value,onContactUpdated:g},null,8,["modelValue","name"])):H("",!0)])}}});export{ze as default};
//# sourceMappingURL=Contacts-df8c1f8b.js.map
